-- LENNY HUB - COMPLETE WITH KEY SYSTEM
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local CoreGui = game:GetService("CoreGui")
local Workspace = game:GetService("Workspace")
local TweenService = game:GetService("TweenService")
local HttpService = game:GetService("HttpService")

local LocalPlayer = Players.LocalPlayer
local Camera = Workspace.CurrentCamera

-- VERSION & UPDATE SYSTEM
local CURRENT_VERSION = "v2.2.0"
local VERSION_FILE = "LennyHub_Version.txt"
local UPDATE_CHANGELOG = {
    "â€¢ Fixed aimbot system - working perfectly",
    "â€¢ Added exit confirmation with message",
    "â€¢ Added UI customization options",
    "â€¢ Added manual resize button",
    "â€¢ Fixed minimize button",
    "â€¢ Performance improvements"
}

-- // KEY SYSTEM //
local CORRECT_KEY = "Elena"
local KeyAuthorized = false

local KeyGui = Instance.new("ScreenGui")
KeyGui.Name = "KeySystem"
KeyGui.ResetOnSpawn = false
KeyGui.IgnoreGuiInset = true
if gethui then KeyGui.Parent = gethui() else KeyGui.Parent = CoreGui end

local KeyBg = Instance.new("Frame", KeyGui)
KeyBg.Size = UDim2.new(1, 0, 1, 0)
KeyBg.BackgroundColor3 = Color3.fromRGB(10, 10, 15)
KeyBg.BackgroundTransparency = 0.3
KeyBg.BorderSizePixel = 0

local KeyFrame = Instance.new("Frame", KeyBg)
KeyFrame.Size = UDim2.new(0, 350, 0, 200)
KeyFrame.Position = UDim2.new(0.5, -175, 0.5, -100)
KeyFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
KeyFrame.BorderSizePixel = 0

local KeyFrameCorner = Instance.new("UICorner", KeyFrame)
KeyFrameCorner.CornerRadius = UDim.new(0, 12)

local KeyFrameStroke = Instance.new("UIStroke", KeyFrame)
KeyFrameStroke.Color = Color3.fromRGB(147, 51, 234)
KeyFrameStroke.Thickness = 2

local KeyTitle = Instance.new("TextLabel", KeyFrame)
KeyTitle.Size = UDim2.new(1, 0, 0, 50)
KeyTitle.BackgroundTransparency = 1
KeyTitle.Text = "LENNY HUB - KEY SYSTEM"
KeyTitle.TextColor3 = Color3.fromRGB(147, 51, 234)
KeyTitle.Font = Enum.Font.GothamBlack
KeyTitle.TextSize = 18

local KeySubtitle = Instance.new("TextLabel", KeyFrame)
KeySubtitle.Size = UDim2.new(1, -40, 0, 20)
KeySubtitle.Position = UDim2.new(0, 20, 0, 55)
KeySubtitle.BackgroundTransparency = 1
KeySubtitle.Text = "Enter the key to continue"
KeySubtitle.TextColor3 = Color3.fromRGB(200, 200, 200)
KeySubtitle.Font = Enum.Font.Gotham
KeySubtitle.TextSize = 12

local KeyInput = Instance.new("TextBox", KeyFrame)
KeyInput.Size = UDim2.new(1, -40, 0, 40)
KeyInput.Position = UDim2.new(0, 20, 0, 85)
KeyInput.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
KeyInput.BorderSizePixel = 0
KeyInput.PlaceholderText = "Enter Key..."
KeyInput.PlaceholderColor3 = Color3.fromRGB(150, 150, 150)
KeyInput.Text = ""
KeyInput.TextColor3 = Color3.new(1, 1, 1)
KeyInput.Font = Enum.Font.Gotham
KeyInput.TextSize = 14
KeyInput.ClearTextOnFocus = false

local KeyInputCorner = Instance.new("UICorner", KeyInput)
KeyInputCorner.CornerRadius = UDim.new(0, 8)

local KeyInputStroke = Instance.new("UIStroke", KeyInput)
KeyInputStroke.Color = Color3.fromRGB(147, 51, 234)
KeyInputStroke.Thickness = 1
KeyInputStroke.Transparency = 0.5

local SubmitBtn = Instance.new("TextButton", KeyFrame)
SubmitBtn.Size = UDim2.new(1, -40, 0, 40)
SubmitBtn.Position = UDim2.new(0, 20, 0, 140)
SubmitBtn.BackgroundColor3 = Color3.fromRGB(147, 51, 234)
SubmitBtn.Text = "SUBMIT"
SubmitBtn.TextColor3 = Color3.new(1, 1, 1)
SubmitBtn.Font = Enum.Font.GothamBold
SubmitBtn.TextSize = 14
SubmitBtn.AutoButtonColor = false

local SubmitCorner = Instance.new("UICorner", SubmitBtn)
SubmitCorner.CornerRadius = UDim.new(0, 8)

local StatusLabel = Instance.new("TextLabel", KeyFrame)
StatusLabel.Size = UDim2.new(1, -40, 0, 20)
StatusLabel.Position = UDim2.new(0, 20, 0, 185)
StatusLabel.BackgroundTransparency = 1
StatusLabel.Text = ""
StatusLabel.TextColor3 = Color3.fromRGB(239, 68, 68)
StatusLabel.Font = Enum.Font.Gotham
StatusLabel.TextSize = 11
StatusLabel.Visible = false

local function ValidateKey()
    local enteredKey = KeyInput.Text
    
    if enteredKey == CORRECT_KEY then
        StatusLabel.TextColor3 = Color3.fromRGB(34, 197, 94)
        StatusLabel.Text = "Key Accepted! Loading..."
        StatusLabel.Visible = true
        SubmitBtn.BackgroundColor3 = Color3.fromRGB(34, 197, 94)
        
        wait(1)
        KeyAuthorized = true
        KeyGui:Destroy()
        StartMainScript()
    else
        StatusLabel.TextColor3 = Color3.fromRGB(239, 68, 68)
        StatusLabel.Text = "Invalid Key! Try again."
        StatusLabel.Visible = true
        SubmitBtn.BackgroundColor3 = Color3.fromRGB(239, 68, 68)
        
        TweenService:Create(KeyFrame, TweenInfo.new(0.1, Enum.EasingStyle.Linear, Enum.EasingDirection.InOut, 0, true), 
            {Position = UDim2.new(0.5, -165, 0.5, -100)}):Play()
        
        wait(0.2)
        KeyFrame.Position = UDim2.new(0.5, -175, 0.5, -100)
        SubmitBtn.BackgroundColor3 = Color3.fromRGB(147, 51, 234)
        
        wait(2)
        StatusLabel.Visible = false
        KeyInput.Text = ""
    end
end

SubmitBtn.MouseButton1Click:Connect(ValidateKey)
KeyInput.FocusLost:Connect(function(enterPressed)
    if enterPressed then ValidateKey() end
end)

SubmitBtn.MouseEnter:Connect(function()
    TweenService:Create(SubmitBtn, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(170, 70, 255)}):Play()
end)

SubmitBtn.MouseLeave:Connect(function()
    TweenService:Create(SubmitBtn, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(147, 51, 234)}):Play()
end)

-- // MAIN SCRIPT FUNCTION //
function StartMainScript()
    -- Check version
    local function CheckVersion()
        local showUpdate = true
        if isfile and readfile and isfile(VERSION_FILE) then
            local savedVersion = readfile(VERSION_FILE)
            if savedVersion == CURRENT_VERSION then
                showUpdate = false
            end
        end
        return showUpdate
    end
    
    local function SaveVersion()
        if writefile then
            writefile(VERSION_FILE, CURRENT_VERSION)
        end
    end
    
    local showUpdatePanel = CheckVersion()

    local LoadingGui = Instance.new("ScreenGui")
    LoadingGui.Name = "LoadingScreen"
    LoadingGui.ResetOnSpawn = false
    LoadingGui.IgnoreGuiInset = true
    if gethui then LoadingGui.Parent = gethui() else LoadingGui.Parent = CoreGui end

    local LoadingBg = Instance.new("Frame", LoadingGui)
    LoadingBg.Size = UDim2.new(1, 0, 1, 0)
    LoadingBg.BackgroundColor3 = Color3.fromRGB(10, 10, 15)
    LoadingBg.BorderSizePixel = 0

    local LoadingFrame = Instance.new("Frame", LoadingBg)
    LoadingFrame.Size = UDim2.new(0, 300, 0, 150)
    LoadingFrame.Position = UDim2.new(0.5, -150, 0.5, -75)
    LoadingFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
    LoadingFrame.BorderSizePixel = 0

    local LoadingCorner = Instance.new("UICorner", LoadingFrame)
    LoadingCorner.CornerRadius = UDim.new(0, 12)

    local LoadingStroke = Instance.new("UIStroke", LoadingFrame)
    LoadingStroke.Color = Color3.fromRGB(147, 51, 234)
    LoadingStroke.Thickness = 2

    local LoadingTitle = Instance.new("TextLabel", LoadingFrame)
    LoadingTitle.Size = UDim2.new(1, 0, 0, 40)
    LoadingTitle.Position = UDim2.new(0, 0, 0, 20)
    LoadingTitle.BackgroundTransparency = 1
    LoadingTitle.Text = "LENNY HUB " .. CURRENT_VERSION
    LoadingTitle.TextColor3 = Color3.fromRGB(147, 51, 234)
    LoadingTitle.Font = Enum.Font.GothamBlack
    LoadingTitle.TextSize = 20

    local LoadingStatus = Instance.new("TextLabel", LoadingFrame)
    LoadingStatus.Size = UDim2.new(1, -40, 0, 20)
    LoadingStatus.Position = UDim2.new(0, 20, 0, 70)
    LoadingStatus.BackgroundTransparency = 1
    LoadingStatus.Text = "Initializing..."
    LoadingStatus.TextColor3 = Color3.fromRGB(200, 200, 200)
    LoadingStatus.Font = Enum.Font.Gotham
    LoadingStatus.TextSize = 12

    local LoadingBar = Instance.new("Frame", LoadingFrame)
    LoadingBar.Size = UDim2.new(0.85, 0, 0, 6)
    LoadingBar.Position = UDim2.new(0.075, 0, 0, 105)
    LoadingBar.BackgroundColor3 = Color3.fromRGB(50, 50, 60)
    LoadingBar.BorderSizePixel = 0

    local LoadingBarCorner = Instance.new("UICorner", LoadingBar)
    LoadingBarCorner.CornerRadius = UDim.new(1, 0)

    local LoadingProgress = Instance.new("Frame", LoadingBar)
    LoadingProgress.Size = UDim2.new(0, 0, 1, 0)
    LoadingProgress.BackgroundColor3 = Color3.fromRGB(147, 51, 234)
    LoadingProgress.BorderSizePixel = 0

    local LoadingProgressCorner = Instance.new("UICorner", LoadingProgress)
    LoadingProgressCorner.CornerRadius = UDim.new(1, 0)

    local loadingSteps = {
        {text = "Initializing...", progress = 0.1},
        {text = "Loading UI components...", progress = 0.3},
        {text = "Setting up aim system...", progress = 0.5},
        {text = "Configuring ESP...", progress = 0.7},
        {text = "Loading saved config...", progress = 0.9},
        {text = "Complete!", progress = 1}
    }

    local DefaultConfig = {
        AimEnabled = false,
        TeamCheck = false,
        ESPEnabled = false,
        ESPNames = true,
        ESPDistance = true,
        ESPHealth = true,
        ESPBoxes = false,
        HighlightEnabled = false,
        WallCheck = false,
        ShowFOV = false,
        ShowCrosshair = false,
        FOV = 120,
        Smoothness = 0.25,
        MaxDistance = 500,
        Prediction = 0.1,
        AimPart = "Head",
        CrosshairSize = 14,
        ESPTextSize = 14,
        ESPTextSpacing = 16,
        UIScale = 1,
        
        FOVColor = {147, 51, 234},
        CrosshairColor = {147, 51, 234},
        ESPColor = {255, 0, 255},
        ESPTextColor = {255, 255, 255},
        ESPBoxColor = {147, 51, 234},
        HighlightColor = {147, 51, 234},
        ThemeColor = {147, 51, 234},
        
        RainbowFOV = false,
        RainbowCrosshair = false,
        RainbowESP = false,
        RainbowHighlight = false,
    }

    local Config = {}
    for k, v in pairs(DefaultConfig) do
        if type(v) == "table" then
            Config[k] = {v[1], v[2], v[3]}
        else
            Config[k] = v
        end
    end

    local function RGBToColor3(rgb)
        return Color3.fromRGB(rgb[1], rgb[2], rgb[3])
    end

    local RandomAimData = {ShotCount = 0, MaxShots = 5, CurrentPart = "Head"}
    local ESPObjects = {}
    local CurrentConfigSlot = 1
    local MaxConfigSlots = 5
    local ConfigFilePrefix = "LennyHub_Config_Slot_"
    local RainbowHue = 0

    local function GetConfigFileName()
        return ConfigFilePrefix .. tostring(CurrentConfigSlot) .. ".json"
    end

    local function SaveConfig()
        pcall(function()
            local fileName = GetConfigFileName()
            writefile(fileName, HttpService:JSONEncode(Config))
            game:GetService("StarterGui"):SetCore("SendNotification", {
                Title = "LENNY HUB",
                Text = "Config saved to Slot " .. CurrentConfigSlot .. "!",
                Duration = 3
            })
        end)
    end

    local function LoadConfig()
        local success = pcall(function()
            local fileName = GetConfigFileName()
            if isfile and isfile(fileName) then
                local loadedConfig = HttpService:JSONDecode(readfile(fileName))
                for key, value in pairs(loadedConfig) do
                    if Config[key] ~= nil then Config[key] = value end
                end
                game:GetService("StarterGui"):SetCore("SendNotification", {
                    Title = "LENNY HUB",
                    Text = "Config loaded from Slot " .. CurrentConfigSlot .. "!",
                    Duration = 3
                })
                return true
            else
                game:GetService("StarterGui"):SetCore("SendNotification", {
                    Title = "LENNY HUB",
                    Text = "No config found in Slot " .. CurrentConfigSlot,
                    Duration = 3
                })
            end
        end)
        return success
    end

    local function DeleteConfig()
        pcall(function()
            local fileName = GetConfigFileName()
            if isfile and isfile(fileName) then
                delfile(fileName)
                game:GetService("StarterGui"):SetCore("SendNotification", {
                    Title = "LENNY HUB",
                    Text = "Config deleted from Slot " .. CurrentConfigSlot .. "!",
                    Duration = 3
                })
            else
                game:GetService("StarterGui"):SetCore("SendNotification", {
                    Title = "LENNY HUB",
                    Text = "No config to delete in Slot " .. CurrentConfigSlot,
                    Duration = 3
                })
            end
        end)
    end

    local function GetSavedSlotsCount()
        local count = 0
        for i = 1, MaxConfigSlots do
            local fileName = ConfigFilePrefix .. tostring(i) .. ".json"
            if isfile and isfile(fileName) then
                count = count + 1
            end
        end
        return count
    end

    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "LennyHub"
    ScreenGui.ResetOnSpawn = false
    ScreenGui.IgnoreGuiInset = true
    if gethui then ScreenGui.Parent = gethui() else ScreenGui.Parent = CoreGui end

    -- EXIT CONFIRMATION PANEL
    local ExitPanel = Instance.new("Frame", ScreenGui)
    ExitPanel.Size = UDim2.new(0, 350, 0, 180)
    ExitPanel.Position = UDim2.new(0.5, -175, 0.5, -90)
    ExitPanel.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
    ExitPanel.BorderSizePixel = 0
    ExitPanel.Visible = false
    ExitPanel.ZIndex = 2000

    local ExitCorner = Instance.new("UICorner", ExitPanel)
    ExitCorner.CornerRadius = UDim.new(0, 12)

    local ExitStroke = Instance.new("UIStroke", ExitPanel)
    ExitStroke.Color = Color3.fromRGB(239, 68, 68)
    ExitStroke.Thickness = 3

    local ExitIcon = Instance.new("TextLabel", ExitPanel)
    ExitIcon.Size = UDim2.new(1, 0, 0, 50)
    ExitIcon.Position = UDim2.new(0, 0, 0, 15)
    ExitIcon.BackgroundTransparency = 1
    ExitIcon.Text = "ðŸ‘‹"
    ExitIcon.TextColor3 = Color3.fromRGB(255, 200, 100)
    ExitIcon.Font = Enum.Font.GothamBlack
    ExitIcon.TextSize = 40
    ExitIcon.ZIndex = 2001

    local ExitTitle = Instance.new("TextLabel", ExitPanel)
    ExitTitle.Size = UDim2.new(1, -40, 0, 30)
    ExitTitle.Position = UDim2.new(0, 20, 0, 70)
    ExitTitle.BackgroundTransparency = 1
    ExitTitle.Text = "Thank you for using Lenny Hub!"
    ExitTitle.TextColor3 = Color3.new(1, 1, 1)
    ExitTitle.Font = Enum.Font.GothamBold
    ExitTitle.TextSize = 16
    ExitTitle.TextWrapped = true
    ExitTitle.ZIndex = 2001

    local ExitMessage = Instance.new("TextLabel", ExitPanel)
    ExitMessage.Size = UDim2.new(1, -40, 0, 25)
    ExitMessage.Position = UDim2.new(0, 20, 0, 100)
    ExitMessage.BackgroundTransparency = 1
    ExitMessage.Text = "See you next time!"
    ExitMessage.TextColor3 = Color3.fromRGB(200, 200, 200)
    ExitMessage.Font = Enum.Font.Gotham
    ExitMessage.TextSize = 13
    ExitMessage.ZIndex = 2001

    local ExitConfirmBtn = Instance.new("TextButton", ExitPanel)
    ExitConfirmBtn.Size = UDim2.new(0, 140, 0, 35)
    ExitConfirmBtn.Position = UDim2.new(0.5, -145, 0, 135)
    ExitConfirmBtn.BackgroundColor3 = Color3.fromRGB(239, 68, 68)
    ExitConfirmBtn.Text = "Yes, Exit"
    ExitConfirmBtn.TextColor3 = Color3.new(1, 1, 1)
    ExitConfirmBtn.Font = Enum.Font.GothamBold
    ExitConfirmBtn.TextSize = 13
    ExitConfirmBtn.AutoButtonColor = false
    ExitConfirmBtn.ZIndex = 2001

    local ExitConfirmCorner = Instance.new("UICorner", ExitConfirmBtn)
    ExitConfirmCorner.CornerRadius = UDim.new(0, 8)

    local ExitCancelBtn = Instance.new("TextButton", ExitPanel)
    ExitCancelBtn.Size = UDim2.new(0, 140, 0, 35)
    ExitCancelBtn.Position = UDim2.new(0.5, 5, 0, 135)
    ExitCancelBtn.BackgroundColor3 = Color3.fromRGB(100, 100, 110)
    ExitCancelBtn.Text = "Cancel"
    ExitCancelBtn.TextColor3 = Color3.new(1, 1, 1)
    ExitCancelBtn.Font = Enum.Font.GothamBold
    ExitCancelBtn.TextSize = 13
    ExitCancelBtn.AutoButtonColor = false
    ExitCancelBtn.ZIndex = 2001

    local ExitCancelCorner = Instance.new("UICorner", ExitCancelBtn)
    ExitCancelCorner.CornerRadius = UDim.new(0, 8)

    -- UPDATE PANEL
    local UpdatePanel = Instance.new("Frame", ScreenGui)
    UpdatePanel.Size = UDim2.new(0, 400, 0, 320)
    UpdatePanel.Position = UDim2.new(0.5, -200, 0.5, -160)
    UpdatePanel.BackgroundColor3 = Color3.fromRGB(20, 20, 28)
    UpdatePanel.BorderSizePixel = 0
    UpdatePanel.Visible = false
    UpdatePanel.ZIndex = 1000

    local UpdateCorner = Instance.new("UICorner", UpdatePanel)
    UpdateCorner.CornerRadius = UDim.new(0, 12)

    local UpdateStroke = Instance.new("UIStroke", UpdatePanel)
    UpdateStroke.Color = Color3.fromRGB(147, 51, 234)
    UpdateStroke.Thickness = 3

    local UpdateHeader = Instance.new("Frame", UpdatePanel)
    UpdateHeader.Size = UDim2.new(1, 0, 0, 60)
    UpdateHeader.BackgroundColor3 = Color3.fromRGB(147, 51, 234)
    UpdateHeader.BorderSizePixel = 0
    UpdateHeader.ZIndex = 1001

    local UpdateHeaderCorner = Instance.new("UICorner", UpdateHeader)
    UpdateHeaderCorner.CornerRadius = UDim.new(0, 12)

    local UpdateHeaderCover = Instance.new("Frame", UpdateHeader)
    UpdateHeaderCover.Size = UDim2.new(1, 0, 0, 12)
    UpdateHeaderCover.Position = UDim2.new(0, 0, 1, -12)
    UpdateHeaderCover.BackgroundColor3 = Color3.fromRGB(147, 51, 234)
    UpdateHeaderCover.BorderSizePixel = 0
    UpdateHeaderCover.ZIndex = 1001

    local UpdateTitleLabel = Instance.new("TextLabel", UpdateHeader)
    UpdateTitleLabel.Size = UDim2.new(1, -60, 0, 30)
    UpdateTitleLabel.Position = UDim2.new(0, 20, 0, 8)
    UpdateTitleLabel.BackgroundTransparency = 1
    UpdateTitleLabel.Text = "ðŸŽ‰ NEW UPDATE!"
    UpdateTitleLabel.TextColor3 = Color3.new(1, 1, 1)
    UpdateTitleLabel.Font = Enum.Font.GothamBlack
    UpdateTitleLabel.TextSize = 20
    UpdateTitleLabel.TextXAlignment = Enum.TextXAlignment.Left
    UpdateTitleLabel.ZIndex = 1002

    local UpdateVersionLabel = Instance.new("TextLabel", UpdateHeader)
    UpdateVersionLabel.Size = UDim2.new(1, -60, 0, 20)
    UpdateVersionLabel.Position = UDim2.new(0, 20, 0, 35)
    UpdateVersionLabel.BackgroundTransparency = 1
    UpdateVersionLabel.Text = "Version " .. CURRENT_VERSION
    UpdateVersionLabel.TextColor3 = Color3.fromRGB(230, 230, 255)
    UpdateVersionLabel.Font = Enum.Font.Gotham
    UpdateVersionLabel.TextSize = 13
    UpdateVersionLabel.TextXAlignment = Enum.TextXAlignment.Left
    UpdateVersionLabel.ZIndex = 1002

    local UpdateCloseBtn = Instance.new("TextButton", UpdateHeader)
    UpdateCloseBtn.Size = UDim2.new(0, 35, 0, 35)
    UpdateCloseBtn.Position = UDim2.new(1, -45, 0, 12)
    UpdateCloseBtn.BackgroundColor3 = Color3.fromRGB(239, 68, 68)
    UpdateCloseBtn.Text = "Ã—"
    UpdateCloseBtn.TextColor3 = Color3.new(1, 1, 1)
    UpdateCloseBtn.Font = Enum.Font.GothamBlack
    UpdateCloseBtn.TextSize = 24
    UpdateCloseBtn.AutoButtonColor = false
    UpdateCloseBtn.ZIndex = 1002

    local UpdateCloseBtnCorner = Instance.new("UICorner", UpdateCloseBtn)
    UpdateCloseBtnCorner.CornerRadius = UDim.new(0, 8)

    local UpdateContent = Instance.new("ScrollingFrame", UpdatePanel)
    UpdateContent.Size = UDim2.new(1, -40, 1, -100)
    UpdateContent.Position = UDim2.new(0, 20, 0, 70)
    UpdateContent.BackgroundTransparency = 1
    UpdateContent.BorderSizePixel = 0
    UpdateContent.ScrollBarThickness = 4
    UpdateContent.ScrollBarImageColor3 = Color3.fromRGB(147, 51, 234)
    UpdateContent.CanvasSize = UDim2.new(0, 0, 0, 0)
    UpdateContent.AutomaticCanvasSize = Enum.AutomaticSize.Y
    UpdateContent.ZIndex = 1001

    local UpdateListLayout = Instance.new("UIListLayout", UpdateContent)
    UpdateListLayout.Padding = UDim.new(0, 8)
    UpdateListLayout.SortOrder = Enum.SortOrder.LayoutOrder

    local ChangelogTitle = Instance.new("TextLabel", UpdateContent)
    ChangelogTitle.Size = UDim2.new(1, 0, 0, 25)
    ChangelogTitle.BackgroundTransparency = 1
    ChangelogTitle.Text = "WHAT'S NEW:"
    ChangelogTitle.TextColor3 = Color3.fromRGB(147, 51, 234)
    ChangelogTitle.Font = Enum.Font.GothamBold
    ChangelogTitle.TextSize = 14
    ChangelogTitle.TextXAlignment = Enum.TextXAlignment.Left
    ChangelogTitle.ZIndex = 1002

    for i, change in ipairs(UPDATE_CHANGELOG) do
        local changeLine = Instance.new("TextLabel", UpdateContent)
        changeLine.Size = UDim2.new(1, -10, 0, 0)
        changeLine.AutomaticSize = Enum.AutomaticSize.Y
        changeLine.BackgroundTransparency = 1
        changeLine.Text = change
        changeLine.TextColor3 = Color3.fromRGB(220, 220, 230)
        changeLine.Font = Enum.Font.Gotham
        changeLine.TextSize = 12
        changeLine.TextXAlignment = Enum.TextXAlignment.Left
        changeLine.TextWrapped = true
        changeLine.TextYAlignment = Enum.TextYAlignment.Top
        changeLine.ZIndex = 1002
        changeLine.LayoutOrder = i
    end

    UpdateCloseBtn.MouseButton1Click:Connect(function()
        TweenService:Create(UpdatePanel, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.In), 
            {Size = UDim2.new(0, 0, 0, 0), Position = UDim2.new(0.5, 0, 0.5, 0)}):Play()
        wait(0.3)
        UpdatePanel.Visible = false
        SaveVersion()
    end)

    UpdateCloseBtn.MouseEnter:Connect(function()
        TweenService:Create(UpdateCloseBtn, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(220, 50, 50)}):Play()
    end)

    UpdateCloseBtn.MouseLeave:Connect(function()
        TweenService:Create(UpdateCloseBtn, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(239, 68, 68)}):Play()
    end)

    -- MAIN FRAME (SAME SIZE FOR ALL DEVICES)
    local MainFrame = Instance.new("Frame", ScreenGui)
    MainFrame.Size = UDim2.new(0, 340, 0, 450)
    MainFrame.Position = UDim2.new(0.5, -170, 0.5, -225)
    MainFrame.BackgroundColor3 = Color3.fromRGB(18, 18, 23)
    MainFrame.BorderSizePixel = 0
    MainFrame.Active = true
    MainFrame.Draggable = true
    MainFrame.Visible = false
    MainFrame.ClipsDescendants = true

    local MainCorner = Instance.new("UICorner", MainFrame)
    MainCorner.CornerRadius = UDim.new(0, 10)

    local MainStroke = Instance.new("UIStroke", MainFrame)
    MainStroke.Color = Color3.fromRGB(147, 51, 234)
    MainStroke.Thickness = 2

    local TopBar = Instance.new("Frame", MainFrame)
    TopBar.Size = UDim2.new(1, 0, 0, 42)
    TopBar.BackgroundColor3 = Color3.fromRGB(28, 28, 35)
    TopBar.BorderSizePixel = 0

    local TopBarCorner = Instance.new("UICorner", TopBar)
    TopBarCorner.CornerRadius = UDim.new(0, 10)

    local TopBarCover = Instance.new("Frame", TopBar)
    TopBarCover.Size = UDim2.new(1, 0, 0, 12)
    TopBarCover.Position = UDim2.new(0, 0, 1, -12)
    TopBarCover.BackgroundColor3 = Color3.fromRGB(28, 28, 35)
    TopBarCover.BorderSizePixel = 0

    local Title = Instance.new("TextLabel", TopBar)
    Title.Size = UDim2.new(1, -165, 1, 0)
    Title.Position = UDim2.new(0, 12, 0, 0)
    Title.BackgroundTransparency = 1
    Title.Text = "LENNY HUB " .. CURRENT_VERSION
    Title.TextColor3 = Color3.fromRGB(147, 51, 234)
    Title.Font = Enum.Font.GothamBlack
    Title.TextSize = 14
    Title.TextXAlignment = Enum.TextXAlignment.Left

    -- RESIZE BUTTON
    local ResizeBtn = Instance.new("TextButton", TopBar)
    ResizeBtn.Size = UDim2.new(0, 28, 0, 28)
    ResizeBtn.Position = UDim2.new(1, -130, 0.5, -14)
    ResizeBtn.BackgroundColor3 = Color3.fromRGB(100, 200, 100)
    ResizeBtn.Text = "â›¶"
    ResizeBtn.TextColor3 = Color3.new(1, 1, 1)
    ResizeBtn.Font = Enum.Font.GothamBold
    ResizeBtn.TextSize = 16
    ResizeBtn.AutoButtonColor = false

    local ResizeBtnCorner = Instance.new("UICorner", ResizeBtn)
    ResizeBtnCorner.CornerRadius = UDim.new(0, 6)

    local UpdatesBtn = Instance.new("TextButton", TopBar)
    UpdatesBtn.Size = UDim2.new(0, 28, 0, 28)
    UpdatesBtn.Position = UDim2.new(1, -98, 0.5, -14)
    UpdatesBtn.BackgroundColor3 = Color3.fromRGB(147, 51, 234)
    UpdatesBtn.Text = "ðŸ“‹"
    UpdatesBtn.TextColor3 = Color3.new(1, 1, 1)
    UpdatesBtn.Font = Enum.Font.GothamBold
    UpdatesBtn.TextSize = 14
    UpdatesBtn.AutoButtonColor = false

    local UpdatesBtnCorner = Instance.new("UICorner", UpdatesBtn)
    UpdatesBtnCorner.CornerRadius = UDim.new(0, 6)

    local SuggestBtn = Instance.new("TextButton", TopBar)
    SuggestBtn.Size = UDim2.new(0, 28, 0, 28)
    SuggestBtn.Position = UDim2.new(1, -65, 0.5, -14)
    SuggestBtn.BackgroundColor3 = Color3.fromRGB(59, 130, 246)
    SuggestBtn.Text = "?"
    SuggestBtn.TextColor3 = Color3.new(1, 1, 1)
    SuggestBtn.Font = Enum.Font.GothamBold
    SuggestBtn.TextSize = 16
    SuggestBtn.AutoButtonColor = false

    local SuggestCorner = Instance.new("UICorner", SuggestBtn)
    SuggestCorner.CornerRadius = UDim.new(0, 6)

    -- CLOSE BUTTON
    local CloseBtn = Instance.new("TextButton", TopBar)
    CloseBtn.Size = UDim2.new(0, 28, 0, 28)
    CloseBtn.Position = UDim2.new(1, -32, 0.5, -14)
    CloseBtn.BackgroundColor3 = Color3.fromRGB(239, 68, 68)
    CloseBtn.Text = "Ã—"
    CloseBtn.TextColor3 = Color3.new(1, 1, 1)
    CloseBtn.Font = Enum.Font.GothamBlack
    CloseBtn.TextSize = 20
    CloseBtn.AutoButtonColor = false

    local CloseCorner = Instance.new("UICorner", CloseBtn)
    CloseCorner.CornerRadius = UDim.new(0, 6)

    -- MINIMIZE BUTTON (BALL)
    local RestoreBtn = Instance.new("TextButton", ScreenGui)
    RestoreBtn.Size = UDim2.new(0, 50, 0, 50)
    RestoreBtn.Position = UDim2.new(0, 20, 0.5, -25)
    RestoreBtn.BackgroundColor3 = Color3.fromRGB(147, 51, 234)
    RestoreBtn.Text = "L"
    RestoreBtn.TextColor3 = Color3.new(1, 1, 1)
    RestoreBtn.Font = Enum.Font.GothamBlack
    RestoreBtn.TextSize = 26
    RestoreBtn.Visible = false
    RestoreBtn.AutoButtonColor = false
    RestoreBtn.ZIndex = 500

    local RestoreCorner = Instance.new("UICorner", RestoreBtn)
    RestoreCorner.CornerRadius = UDim.new(1, 0)

    local RestoreStroke = Instance.new("UIStroke", RestoreBtn)
    RestoreStroke.Color = Color3.fromRGB(147, 51, 234)
    RestoreStroke.Thickness = 3

    local SuggestPanel = Instance.new("Frame", ScreenGui)
    SuggestPanel.Size = UDim2.new(0, 300, 0, 220)
    SuggestPanel.Position = UDim2.new(0.5, -150, 0.5, -110)
    SuggestPanel.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
    SuggestPanel.BorderSizePixel = 0
    SuggestPanel.Visible = false
    SuggestPanel.ZIndex = 600

    local SuggestCornerUI = Instance.new("UICorner", SuggestPanel)
    SuggestCornerUI.CornerRadius = UDim.new(0, 10)

    local SuggestStroke = Instance.new("UIStroke", SuggestPanel)
    SuggestStroke.Color = Color3.fromRGB(59, 130, 246)
    SuggestStroke.Thickness = 2

    local SuggestTitle = Instance.new("TextLabel", SuggestPanel)
    SuggestTitle.Size = UDim2.new(1, -40, 0, 35)
    SuggestTitle.Position = UDim2.new(0, 15, 0, 10)
    SuggestTitle.BackgroundTransparency = 1
    SuggestTitle.Text = "PRO TIPS"
    SuggestTitle.TextColor3 = Color3.fromRGB(59, 130, 246)
    SuggestTitle.Font = Enum.Font.GothamBold
    SuggestTitle.TextSize = 16
    SuggestTitle.TextXAlignment = Enum.TextXAlignment.Left
    SuggestTitle.ZIndex = 601

    local SuggestClose = Instance.new("TextButton", SuggestPanel)
    SuggestClose.Size = UDim2.new(0, 25, 0, 25)
    SuggestClose.Position = UDim2.new(1, -30, 0, 10)
    SuggestClose.BackgroundColor3 = Color3.fromRGB(239, 68, 68)
    SuggestClose.Text = "Ã—"
    SuggestClose.TextColor3 = Color3.new(1, 1, 1)
    SuggestClose.Font = Enum.Font.GothamBold
    SuggestClose.TextSize = 16
    SuggestClose.AutoButtonColor = false
    SuggestClose.ZIndex = 601

    local SuggestCloseCorner = Instance.new("UICorner", SuggestClose)
    SuggestCloseCorner.CornerRadius = UDim.new(0, 5)

    local tips = {
        "â€¢ Lower smoothness = More legit aim",
        "â€¢ Use 100-150 FOV for best results",
        "â€¢ Enable Wall Check to avoid targeting through walls",
        "â€¢ Random aim part helps avoid detection",
        "â€¢ ESP Boxes show 3D frames around players",
        "â€¢ Use resize button to make UI bigger/smaller",
        "â€¢ Save your config after tweaking!"
    }

    local SuggestText = Instance.new("TextLabel", SuggestPanel)
    SuggestText.Size = UDim2.new(1, -30, 1, -55)
    SuggestText.Position = UDim2.new(0, 15, 0, 45)
    SuggestText.BackgroundTransparency = 1
    SuggestText.Text = table.concat(tips, "\n")
    SuggestText.TextColor3 = Color3.fromRGB(200, 200, 200)
    SuggestText.Font = Enum.Font.Gotham
    SuggestText.TextSize = 11
    SuggestText.TextXAlignment = Enum.TextXAlignment.Left
    SuggestText.TextYAlignment = Enum.TextYAlignment.Top
    SuggestText.TextWrapped = true
    SuggestText.ZIndex = 601

    local Content = Instance.new("ScrollingFrame", MainFrame)
    Content.Size = UDim2.new(1, -16, 1, -52)
    Content.Position = UDim2.new(0, 8, 0, 46)
    Content.BackgroundTransparency = 1
    Content.BorderSizePixel = 0
    Content.ScrollBarThickness = 3
    Content.ScrollBarImageColor3 = Color3.fromRGB(147, 51, 234)
    Content.CanvasSize = UDim2.new(0, 0, 0, 0)
    Content.AutomaticCanvasSize = Enum.AutomaticSize.Y

    local ContentLayout = Instance.new("UIListLayout", Content)
    ContentLayout.Padding = UDim.new(0, 8)
    ContentLayout.SortOrder = Enum.SortOrder.LayoutOrder

    -- FOV CIRCLE (FIXED)
    local FOVCircle = Instance.new("Frame", ScreenGui)
    FOVCircle.AnchorPoint = Vector2.new(0.5, 0.5)
    FOVCircle.Size = UDim2.new(0, Config.FOV, 0, Config.FOV)
    FOVCircle.BackgroundTransparency = 1
    FOVCircle.Visible = false
    FOVCircle.ZIndex = 10

    local FOVStroke = Instance.new("UIStroke", FOVCircle)
    FOVStroke.Color = RGBToColor3(Config.FOVColor)
    FOVStroke.Thickness = 2
    FOVStroke.Transparency = 0.3

    local FOVCorner = Instance.new("UICorner", FOVCircle)
    FOVCorner.CornerRadius = UDim.new(1, 0)

    local Crosshair = Instance.new("Frame", ScreenGui)
    Crosshair.AnchorPoint = Vector2.new(0.5, 0.5)
    Crosshair.Size = UDim2.new(0, 4, 0, 4)
    Crosshair.BackgroundColor3 = RGBToColor3(Config.CrosshairColor)
    Crosshair.BorderSizePixel = 0
    Crosshair.Visible = false
    Crosshair.ZIndex = 11

    local CrosshairCorner = Instance.new("UICorner", Crosshair)
    CrosshairCorner.CornerRadius = UDim.new(1, 0)

    local HorizontalLine = Instance.new("Frame", ScreenGui)
    HorizontalLine.AnchorPoint = Vector2.new(0.5, 0.5)
    HorizontalLine.Size = UDim2.new(0, Config.CrosshairSize, 0, 2)
    HorizontalLine.BackgroundColor3 = RGBToColor3(Config.CrosshairColor)
    HorizontalLine.BorderSizePixel = 0
    HorizontalLine.BackgroundTransparency = 0.3
    HorizontalLine.Visible = false
    HorizontalLine.ZIndex = 11

    local VerticalLine = Instance.new("Frame", ScreenGui)
    VerticalLine.AnchorPoint = Vector2.new(0.5, 0.5)
    VerticalLine.Size = UDim2.new(0, 2, 0, Config.CrosshairSize)
    VerticalLine.BackgroundColor3 = RGBToColor3(Config.CrosshairColor)
    VerticalLine.BorderSizePixel = 0
    VerticalLine.BackgroundTransparency = 0.3
    VerticalLine.Visible = false
    VerticalLine.ZIndex = 11

    -- FIXED FOV POSITIONING
    local function UpdateFOVPosition()
        local viewportSize = Camera.ViewportSize
        local centerX = viewportSize.X / 2
        local centerY = viewportSize.Y / 2
        
        FOVCircle.Position = UDim2.new(0, centerX, 0, centerY)
        FOVCircle.Size = UDim2.new(0, Config.FOV, 0, Config.FOV)
        
        Crosshair.Position = UDim2.new(0, centerX, 0, centerY)
        HorizontalLine.Position = UDim2.new(0, centerX, 0, centerY)
        VerticalLine.Position = UDim2.new(0, centerX, 0, centerY)
    end

    -- TARGET HIGHLIGHT
    local TargetHighlight = Instance.new("Highlight", CoreGui)
    TargetHighlight.FillColor = RGBToColor3(Config.HighlightColor)
    TargetHighlight.OutlineColor = Color3.fromRGB(255, 255, 255)
    TargetHighlight.FillTransparency = 0.5
    TargetHighlight.OutlineTransparency = 0
    TargetHighlight.Enabled = false

    local function Animate(obj, property, value)
        TweenService:Create(obj, TweenInfo.new(0.2, Enum.EasingStyle.Quad), {[property] = value}):Play()
    end

    -- BUTTON CONNECTIONS
    ResizeBtn.MouseButton1Click:Connect(function()
        if Config.UIScale == 1 then
            Config.UIScale = 0.8
            ResizeBtn.Text = "â›¶"
        elseif Config.UIScale == 0.8 then
            Config.UIScale = 1.2
            ResizeBtn.Text = "â›¶"
        else
            Config.UIScale = 1
            ResizeBtn.Text = "â›¶"
        end
        
        local newSize = UDim2.new(0, 340 * Config.UIScale, 0, 450 * Config.UIScale)
        TweenService:Create(MainFrame, TweenInfo.new(0.3, Enum.EasingStyle.Quad), {Size = newSize}):Play()
    end)

    UpdatesBtn.MouseButton1Click:Connect(function()
        UpdatePanel.Visible = true
        UpdatePanel.Size = UDim2.new(0, 0, 0, 0)
        UpdatePanel.Position = UDim2.new(0.5, 0, 0.5, 0)
        TweenService:Create(UpdatePanel, TweenInfo.new(0.4, Enum.EasingStyle.Back, Enum.EasingDirection.Out), 
            {Size = UDim2.new(0, 400, 0, 320), Position = UDim2.new(0.5, -200, 0.5, -160)}):Play()
    end)

    SuggestBtn.MouseButton1Click:Connect(function()
        SuggestPanel.Visible = not SuggestPanel.Visible
    end)

    SuggestClose.MouseButton1Click:Connect(function()
        SuggestPanel.Visible = false
    end)

    -- EXIT CONFIRMATION
    CloseBtn.MouseButton1Click:Connect(function()
        ExitPanel.Visible = true
        ExitPanel.Size = UDim2.new(0, 0, 0, 0)
        ExitPanel.Position = UDim2.new(0.5, 0, 0.5, 0)
        TweenService:Create(ExitPanel, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out), 
            {Size = UDim2.new(0, 350, 0, 180), Position = UDim2.new(0.5, -175, 0.5, -90)}):Play()
    end)

    ExitConfirmBtn.MouseButton1Click:Connect(function()
        Config.AimEnabled = false
        Config.ESPEnabled = false
        Config.HighlightEnabled = false
        TargetHighlight.Enabled = false
        for _, esp in pairs(ESPObjects) do 
            if esp.Highlight then esp.Highlight:Destroy() end
            if esp.BillboardGui then esp.BillboardGui:Destroy() end
            if esp.BoxDrawing then 
                for _, line in pairs(esp.BoxDrawing) do
                    line:Remove()
                end
            end
        end
        
        TweenService:Create(ExitPanel, TweenInfo.new(0.3, Enum.EasingStyle.Quad), {BackgroundTransparency = 1}):Play()
        TweenService:Create(ExitIcon, TweenInfo.new(0.3, Enum.EasingStyle.Quad), {TextTransparency = 1}):Play()
        TweenService:Create(ExitTitle, TweenInfo.new(0.3, Enum.EasingStyle.Quad), {TextTransparency = 1}):Play()
        TweenService:Create(ExitMessage, TweenInfo.new(0.3, Enum.EasingStyle.Quad), {TextTransparency = 1}):Play()
        
        wait(0.5)
        ScreenGui:Destroy()
    end)

    ExitCancelBtn.MouseButton1Click:Connect(function()
        TweenService:Create(ExitPanel, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.In), 
            {Size = UDim2.new(0, 0, 0, 0), Position = UDim2.new(0.5, 0, 0.5, 0)}):Play()
        wait(0.3)
        ExitPanel.Visible = false
    end)

    -- MINIMIZE TO BALL
    Title.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            local clickCount = 0
            local lastClick = tick()
            clickCount = clickCount + 1
            
            task.spawn(function()
                wait(0.3)
                if clickCount == 2 and (tick() - lastClick) < 0.3 then
                    -- Double click to minimize
                    MainFrame.Visible = false
                    RestoreBtn.Visible = true
                end
                clickCount = 0
            end)
        end
    end)

    RestoreBtn.MouseButton1Click:Connect(function()
        MainFrame.Visible = true
        RestoreBtn.Visible = false
    end)

    ExitConfirmBtn.MouseEnter:Connect(function() Animate(ExitConfirmBtn, "BackgroundColor3", Color3.fromRGB(220, 50, 50)) end)
    ExitConfirmBtn.MouseLeave:Connect(function() Animate(ExitConfirmBtn, "BackgroundColor3", Color3.fromRGB(239, 68, 68)) end)
    ExitCancelBtn.MouseEnter:Connect(function() Animate(ExitCancelBtn, "BackgroundColor3", Color3.fromRGB(120, 120, 130)) end)
    ExitCancelBtn.MouseLeave:Connect(function() Animate(ExitCancelBtn, "BackgroundColor3", Color3.fromRGB(100, 100, 110)) end)
    CloseBtn.MouseEnter:Connect(function() Animate(CloseBtn, "BackgroundColor3", Color3.fromRGB(220, 50, 50)) end)
    CloseBtn.MouseLeave:Connect(function() Animate(CloseBtn, "BackgroundColor3", Color3.fromRGB(239, 68, 68)) end)

    -- ESP SYSTEM WITH 3D BOXES
    local function WorldToViewportPoint(pos)
        local screenPos, onScreen = Camera:WorldToViewportPoint(pos)
        return Vector2.new(screenPos.X, screenPos.Y), onScreen, screenPos.Z
    end

    local function CreateBoxLine()
        local line = Drawing.new("Line")
        line.Thickness = 2
        line.Color = RGBToColor3(Config.ESPBoxColor)
        line.Transparency = 1
        line.Visible = false
        return line
    end

    local function CreateESP(player)
        if ESPObjects[player] then return end
        
        local espData = {
            Player = player,
            Highlight = nil,
            BillboardGui = nil,
            BoxDrawing = {}
        }
        
        -- Highlight
        local highlight = Instance.new("Highlight")
        highlight.Name = "ESP_" .. player.Name
        highlight.FillColor = RGBToColor3(Config.ESPColor)
        highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
        highlight.FillTransparency = 0.4
        highlight.OutlineTransparency = 0
        highlight.Enabled = false
        highlight.Parent = CoreGui
        espData.Highlight = highlight
        
        -- 3D Box
        if Drawing then
            for i = 1, 12 do
                espData.BoxDrawing[i] = CreateBoxLine()
            end
        end
        
        -- Billboard
        local billboard = Instance.new("BillboardGui")
        billboard.Name = "ESPText_" .. player.Name
        billboard.AlwaysOnTop = true
        billboard.Size = UDim2.new(0, 200, 0, 100)
        billboard.StudsOffset = Vector3.new(0, 3, 0)
        billboard.Enabled = false
        billboard.Parent = CoreGui
        espData.BillboardGui = billboard
        
        local textContainer = Instance.new("Frame", billboard)
        textContainer.Size = UDim2.new(1, 0, 1, 0)
        textContainer.BackgroundTransparency = 1
        
        local nameLabel = Instance.new("TextLabel", textContainer)
        nameLabel.Name = "NameLabel"
        nameLabel.Size = UDim2.new(1, 0, 0, Config.ESPTextSize)
        nameLabel.Position = UDim2.new(0, 0, 0, 0)
        nameLabel.BackgroundTransparency = 1
        nameLabel.Text = player.Name
        nameLabel.TextColor3 = RGBToColor3(Config.ESPTextColor)
        nameLabel.Font = Enum.Font.GothamBold
        nameLabel.TextSize = Config.ESPTextSize
        nameLabel.TextStrokeTransparency = 0.5
        nameLabel.TextStrokeColor3 = Color3.new(0, 0, 0)
        
        local healthLabel = Instance.new("TextLabel", textContainer)
        healthLabel.Name = "HealthLabel"
        healthLabel.Size = UDim2.new(1, 0, 0, Config.ESPTextSize)
        healthLabel.Position = UDim2.new(0, 0, 0, Config.ESPTextSpacing)
        healthLabel.BackgroundTransparency = 1
        healthLabel.Text = "HP: 100"
        healthLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
        healthLabel.Font = Enum.Font.Gotham
        healthLabel.TextSize = Config.ESPTextSize
        healthLabel.TextStrokeTransparency = 0.5
        healthLabel.TextStrokeColor3 = Color3.new(0, 0, 0)
        
        local distanceLabel = Instance.new("TextLabel", textContainer)
        distanceLabel.Name = "DistanceLabel"
        distanceLabel.Size = UDim2.new(1, 0, 0, Config.ESPTextSize)
        distanceLabel.Position = UDim2.new(0, 0, 0, Config.ESPTextSpacing * 2)
        distanceLabel.BackgroundTransparency = 1
        distanceLabel.Text = "0m"
        distanceLabel.TextColor3 = Color3.fromRGB(255, 255, 0)
        distanceLabel.Font = Enum.Font.Gotham
        distanceLabel.TextSize = Config.ESPTextSize
        distanceLabel.TextStrokeTransparency = 0.5
        distanceLabel.TextStrokeColor3 = Color3.new(0, 0, 0)
        
        ESPObjects[player] = espData
    end

    local function RemoveESP(player)
        if ESPObjects[player] then
            if ESPObjects[player].Highlight then ESPObjects[player].Highlight:Destroy() end
            if ESPObjects[player].BillboardGui then ESPObjects[player].BillboardGui:Destroy() end
            if ESPObjects[player].BoxDrawing then
                for _, line in pairs(ESPObjects[player].BoxDrawing) do
                    line:Remove()
                end
            end
            ESPObjects[player] = nil
        end
    end

    local function UpdateESPBoxes(espData, character)
        if not Drawing or not Config.ESPBoxes then 
            if espData.BoxDrawing then
                for _, line in pairs(espData.BoxDrawing) do
                    line.Visible = false
                end
            end
            return 
        end
        
        local rootPart = character:FindFirstChild("HumanoidRootPart")
        if not rootPart then return end
        
        local size = character:GetExtentsSize()
        local position = rootPart.Position
        
        local corners = {
            Vector3.new(-size.X/2, -size.Y/2, -size.Z/2),
            Vector3.new(size.X/2, -size.Y/2, -size.Z/2),
            Vector3.new(-size.X/2, size.Y/2, -size.Z/2),
            Vector3.new(size.X/2, size.Y/2, -size.Z/2),
            Vector3.new(-size.X/2, -size.Y/2, size.Z/2),
            Vector3.new(size.X/2, -size.Y/2, size.Z/2),
            Vector3.new(-size.X/2, size.Y/2, size.Z/2),
            Vector3.new(size.X/2, size.Y/2, size.Z/2)
        }
        
        local screenCorners = {}
        local allOnScreen = true
        
        for i, corner in ipairs(corners) do
            local worldPos = position + corner
            local screenPos, onScreen = WorldToViewportPoint(worldPos)
            screenCorners[i] = screenPos
            if not onScreen then allOnScreen = false end
        end
        
        if not allOnScreen then
            for _, line in pairs(espData.BoxDrawing) do
                line.Visible = false
            end
            return
        end
        
        local connections = {
            {1, 2}, {3, 4}, {5, 6}, {7, 8},
            {1, 3}, {2, 4}, {5, 7}, {6, 8},
            {1, 5}, {2, 6}, {3, 7}, {4, 8}
        }
        
        for i, connection in ipairs(connections) do
            local line = espData.BoxDrawing[i]
            if line then
                line.From = screenCorners[connection[1]]
                line.To = screenCorners[connection[2]]
                line.Color = RGBToColor3(Config.ESPBoxColor)
                line.Visible = true
            end
        end
    end

    local function UpdateESP()
        for player, espData in pairs(ESPObjects) do
            if not player or not player.Parent or not player.Character then
                if espData.Highlight then espData.Highlight.Enabled = false end
                if espData.BillboardGui then espData.BillboardGui.Enabled = false end
                if espData.BoxDrawing then
                    for _, line in pairs(espData.BoxDrawing) do
                        line.Visible = false
                    end
                end
                continue
            end
            
            local character = player.Character
            local humanoid = character:FindFirstChild("Humanoid")
            local rootPart = character:FindFirstChild("HumanoidRootPart")
            
            if not humanoid or humanoid.Health <= 0 or not rootPart then
                if espData.Highlight then espData.Highlight.Enabled = false end
                if espData.BillboardGui then espData.BillboardGui.Enabled = false end
                if espData.BoxDrawing then
                    for _, line in pairs(espData.BoxDrawing) do
                        line.Visible = false
                    end
                end
                continue
            end
            
            if Config.TeamCheck and player.Team == LocalPlayer.Team then
                if espData.Highlight then espData.Highlight.Enabled = false end
                if espData.BillboardGui then espData.BillboardGui.Enabled = false end
                if espData.BoxDrawing then
                    for _, line in pairs(espData.BoxDrawing) do
                        line.Visible = false
                    end
                end
                continue
            end
            
            if Config.ESPEnabled and espData.Highlight then
                espData.Highlight.Adornee = character
                espData.Highlight.FillColor = RGBToColor3(Config.ESPColor)
                espData.Highlight.Enabled = true
            elseif espData.Highlight then
                espData.Highlight.Enabled = false
            end
            
            UpdateESPBoxes(espData, character)
            
            local showText = Config.ESPNames or Config.ESPHealth or Config.ESPDistance
            if showText and espData.BillboardGui then
                espData.BillboardGui.Adornee = rootPart
                espData.BillboardGui.Enabled = true
                
                local container = espData.BillboardGui:FindFirstChild("Frame")
                if container then
                    local nameLabel = container:FindFirstChild("NameLabel")
                    local healthLabel = container:FindFirstChild("HealthLabel")
                    local distanceLabel = container:FindFirstChild("DistanceLabel")
                    
                    if nameLabel then
                        nameLabel.Visible = Config.ESPNames
                        nameLabel.TextSize = Config.ESPTextSize
                        nameLabel.TextColor3 = RGBToColor3(Config.ESPTextColor)
                    end
                    
                    if healthLabel then
                        healthLabel.Visible = Config.ESPHealth
                        healthLabel.TextSize = Config.ESPTextSize
                        healthLabel.Position = UDim2.new(0, 0, 0, Config.ESPTextSpacing)
                        local healthPercent = (humanoid.Health / humanoid.MaxHealth) * 100
                        healthLabel.Text = string.format("HP: %.0f%%", healthPercent)
                        if healthPercent > 75 then
                            healthLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
                        elseif healthPercent > 50 then
                            healthLabel.TextColor3 = Color3.fromRGB(255, 255, 0)
                        elseif healthPercent > 25 then
                            healthLabel.TextColor3 = Color3.fromRGB(255, 165, 0)
                        else
                            healthLabel.TextColor3 = Color3.fromRGB(255, 0, 0)
                        end
                    end
                    
                    if distanceLabel and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
                        distanceLabel.Visible = Config.ESPDistance
                        distanceLabel.TextSize = Config.ESPTextSize
                        distanceLabel.Position = UDim2.new(0, 0, 0, Config.ESPTextSpacing * 2)
                        local distance = (rootPart.Position - LocalPlayer.Character.HumanoidRootPart.Position).Magnitude
                        distanceLabel.Text = string.format("%.0fm", distance)
                    end
                end
            elseif espData.BillboardGui then
                espData.BillboardGui.Enabled = false
            end
        end
    end

    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer then 
            CreateESP(player)
        end
    end

    Players.PlayerAdded:Connect(CreateESP)
    Players.PlayerRemoving:Connect(RemoveESP)

    RunService.Heartbeat:Connect(function()
        RainbowHue = (RainbowHue + 1) % 360
        local rainbowColor = Color3.fromHSV(RainbowHue / 360, 1, 1)
        
        if Config.RainbowFOV then
            Config.FOVColor = {math.floor(rainbowColor.R * 255), math.floor(rainbowColor.G * 255), math.floor(rainbowColor.B * 255)}
            FOVStroke.Color = rainbowColor
        end
        
        if Config.RainbowCrosshair then
            Config.CrosshairColor = {math.floor(rainbowColor.R * 255), math.floor(rainbowColor.G * 255), math.floor(rainbowColor.B * 255)}
            Crosshair.BackgroundColor3 = rainbowColor
            HorizontalLine.BackgroundColor3 = rainbowColor
            VerticalLine.BackgroundColor3 = rainbowColor
        end
        
        if Config.RainbowESP then
            Config.ESPColor = {math.floor(rainbowColor.R * 255), math.floor(rainbowColor.G * 255), math.floor(rainbowColor.B * 255)}
            Config.ESPBoxColor = {math.floor(rainbowColor.R * 255), math.floor(rainbowColor.G * 255), math.floor(rainbowColor.B * 255)}
            for _, esp in pairs(ESPObjects) do
                if esp.Highlight then esp.Highlight.FillColor = rainbowColor end
                if esp.BoxDrawing then
                    for _, line in pairs(esp.BoxDrawing) do
                        line.Color = rainbowColor
                    end
                end
            end
        end
        
        if Config.RainbowHighlight then
            Config.HighlightColor = {math.floor(rainbowColor.R * 255), math.floor(rainbowColor.G * 255), math.floor(rainbowColor.B * 255)}
            TargetHighlight.FillColor = rainbowColor
        end
        
        UpdateFOVPosition()
        UpdateESP()
    end)

    -- UI COMPONENTS (Continue in next part due to length...)
    -- I'll include the rest with WORKING AIMBOT in the next section
