-- LENNY HUB v2.3.0 - COMPLETE FULL SCRIPT
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local CoreGui = game:GetService("CoreGui")
local Workspace = game:GetService("Workspace")
local TweenService = game:GetService("TweenService")
local HttpService = game:GetService("HttpService")

local LocalPlayer = Players.LocalPlayer
local Camera = Workspace.CurrentCamera

-- DEVICE DETECTION
local IsMobile = UserInputService.TouchEnabled and not UserInputService.KeyboardEnabled

-- VERSION
local CURRENT_VERSION = "v2.3.0"

-- CORRECT KEY
local CORRECT_KEY = "Elena"

-- Destroy existing GUI if present
if CoreGui:FindFirstChild("LennyHub") then
    CoreGui:FindFirstChild("LennyHub"):Destroy()
end
if CoreGui:FindFirstChild("KeySystem") then
    CoreGui:FindFirstChild("KeySystem"):Destroy()
end

-- KEY SYSTEM GUI
local KeyGui = Instance.new("ScreenGui")
KeyGui.Name = "KeySystem"
KeyGui.ResetOnSpawn = false
KeyGui.IgnoreGuiInset = true
KeyGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
if syn then KeyGui.Parent = syn.protect_gui and syn.protect_gui(KeyGui) or CoreGui else KeyGui.Parent = CoreGui end

local KeyBackground = Instance.new("Frame")
KeyBackground.Name = "Background"
KeyBackground.Parent = KeyGui
KeyBackground.Size = UDim2.new(1, 0, 1, 0)
KeyBackground.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
KeyBackground.BackgroundTransparency = 0.5
KeyBackground.BorderSizePixel = 0

local KeyFrame = Instance.new("Frame")
KeyFrame.Name = "KeyFrame"
KeyFrame.Parent = KeyBackground
KeyFrame.Size = UDim2.new(0, 350, 0, 220)
KeyFrame.Position = UDim2.new(0.5, -175, 0.5, -110)
KeyFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 28)
KeyFrame.BorderSizePixel = 0

local KeyFrameCorner = Instance.new("UICorner")
KeyFrameCorner.CornerRadius = UDim.new(0, 12)
KeyFrameCorner.Parent = KeyFrame

local KeyFrameStroke = Instance.new("UIStroke")
KeyFrameStroke.Color = Color3.fromRGB(147, 51, 234)
KeyFrameStroke.Thickness = 2
KeyFrameStroke.Parent = KeyFrame

local KeyTitle = Instance.new("TextLabel")
KeyTitle.Name = "Title"
KeyTitle.Parent = KeyFrame
KeyTitle.Size = UDim2.new(1, 0, 0, 50)
KeyTitle.Position = UDim2.new(0, 0, 0, 10)
KeyTitle.BackgroundTransparency = 1
KeyTitle.Text = "üîê LENNY HUB"
KeyTitle.TextColor3 = Color3.fromRGB(147, 51, 234)
KeyTitle.Font = Enum.Font.GothamBlack
KeyTitle.TextSize = 24

local KeySubtitle = Instance.new("TextLabel")
KeySubtitle.Name = "Subtitle"
KeySubtitle.Parent = KeyFrame
KeySubtitle.Size = UDim2.new(1, -40, 0, 20)
KeySubtitle.Position = UDim2.new(0, 20, 0, 60)
KeySubtitle.BackgroundTransparency = 1
KeySubtitle.Text = "Enter the key to access the hub"
KeySubtitle.TextColor3 = Color3.fromRGB(180, 180, 180)
KeySubtitle.Font = Enum.Font.Gotham
KeySubtitle.TextSize = 13

local KeyInput = Instance.new("TextBox")
KeyInput.Name = "Input"
KeyInput.Parent = KeyFrame
KeyInput.Size = UDim2.new(1, -40, 0, 45)
KeyInput.Position = UDim2.new(0, 20, 0, 90)
KeyInput.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
KeyInput.BorderSizePixel = 0
KeyInput.PlaceholderText = "Enter Key Here..."
KeyInput.PlaceholderColor3 = Color3.fromRGB(120, 120, 120)
KeyInput.Text = ""
KeyInput.TextColor3 = Color3.fromRGB(255, 255, 255)
KeyInput.Font = Enum.Font.Gotham
KeyInput.TextSize = 14
KeyInput.ClearTextOnFocus = false

local KeyInputCorner = Instance.new("UICorner")
KeyInputCorner.CornerRadius = UDim.new(0, 8)
KeyInputCorner.Parent = KeyInput

local KeyInputStroke = Instance.new("UIStroke")
KeyInputStroke.Color = Color3.fromRGB(80, 80, 100)
KeyInputStroke.Thickness = 1
KeyInputStroke.Parent = KeyInput

local SubmitButton = Instance.new("TextButton")
SubmitButton.Name = "Submit"
SubmitButton.Parent = KeyFrame
SubmitButton.Size = UDim2.new(1, -40, 0, 45)
SubmitButton.Position = UDim2.new(0, 20, 0, 145)
SubmitButton.BackgroundColor3 = Color3.fromRGB(147, 51, 234)
SubmitButton.BorderSizePixel = 0
SubmitButton.Text = "UNLOCK"
SubmitButton.TextColor3 = Color3.fromRGB(255, 255, 255)
SubmitButton.Font = Enum.Font.GothamBold
SubmitButton.TextSize = 15
SubmitButton.AutoButtonColor = false

local SubmitCorner = Instance.new("UICorner")
SubmitCorner.CornerRadius = UDim.new(0, 8)
SubmitCorner.Parent = SubmitButton

local StatusLabel = Instance.new("TextLabel")
StatusLabel.Name = "Status"
StatusLabel.Parent = KeyFrame
StatusLabel.Size = UDim2.new(1, -40, 0, 20)
StatusLabel.Position = UDim2.new(0, 20, 0, 195)
StatusLabel.BackgroundTransparency = 1
StatusLabel.Text = ""
StatusLabel.TextColor3 = Color3.fromRGB(239, 68, 68)
StatusLabel.Font = Enum.Font.Gotham
StatusLabel.TextSize = 12

-- Key Validation
local function ValidateKey()
    local enteredKey = KeyInput.Text
    
    if enteredKey == CORRECT_KEY then
        StatusLabel.TextColor3 = Color3.fromRGB(34, 197, 94)
        StatusLabel.Text = "‚úì Key Accepted! Loading..."
        SubmitButton.BackgroundColor3 = Color3.fromRGB(34, 197, 94)
        SubmitButton.Text = "SUCCESS"
        
        task.wait(1.5)
        KeyGui:Destroy()
        
        -- START MAIN HUB
        LoadMainHub()
    else
        StatusLabel.TextColor3 = Color3.fromRGB(239, 68, 68)
        StatusLabel.Text = "‚úó Invalid Key!"
        SubmitButton.BackgroundColor3 = Color3.fromRGB(239, 68, 68)
        
        -- Shake animation
        local originalPos = KeyFrame.Position
        for i = 1, 3 do
            TweenService:Create(KeyFrame, TweenInfo.new(0.05), {Position = originalPos + UDim2.new(0, 10, 0, 0)}):Play()
            task.wait(0.05)
            TweenService:Create(KeyFrame, TweenInfo.new(0.05), {Position = originalPos + UDim2.new(0, -10, 0, 0)}):Play()
            task.wait(0.05)
        end
        TweenService:Create(KeyFrame, TweenInfo.new(0.05), {Position = originalPos}):Play()
        
        task.wait(0.5)
        SubmitButton.BackgroundColor3 = Color3.fromRGB(147, 51, 234)
        SubmitButton.Text = "UNLOCK"
        task.wait(1.5)
        StatusLabel.Text = ""
        KeyInput.Text = ""
    end
end

SubmitButton.MouseButton1Click:Connect(ValidateKey)
KeyInput.FocusLost:Connect(function(enterPressed)
    if enterPressed then
        ValidateKey()
    end
end)

-- Hover effects for submit button
SubmitButton.MouseEnter:Connect(function()
    TweenService:Create(SubmitButton, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(167, 71, 254)}):Play()
end)

SubmitButton.MouseLeave:Connect(function()
    TweenService:Create(SubmitButton, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(147, 51, 234)}):Play()
end)

-- MAIN HUB FUNCTION
function LoadMainHub()
    -- Configuration
    local Config = {
        -- Aimbot
        AimEnabled = false,
        AimPart = "Head",
        TeamCheck = false,
        WallCheck = false,
        FOV = 150,
        Smoothness = 0.3,
        MaxDistance = 500,
        Prediction = 0.12,
        
        -- Highlight
        HighlightEnabled = false,
        HighlightColor = {147, 51, 234},
        RainbowHighlight = false,
        
        -- ESP
        ESPEnabled = false,
        ESPNames = true,
        ESPHealth = true,
        ESPDistance = true,
        ESPBoxes = false,
        ESPTextSize = 14,
        ESPColor = {255, 0, 255},
        ESPBoxColor = {147, 51, 234},
        RainbowESP = false,
        
        -- Visuals
        ShowFOV = false,
        FOVColor = {147, 51, 234},
        RainbowFOV = false,
        ShowCrosshair = false,
        CrosshairSize = 16,
        CrosshairColor = {147, 51, 234},
        RainbowCrosshair = false,
        
        -- UI
        ThemeColor = {147, 51, 234},
        RainbowTheme = false,
        UITransparency = 0,
    }
    
    -- Variables
    local ESPObjects = {}
    local CurrentTarget = nil
    local IsMinimized = false
    local RainbowHue = 0
    local ConfigSlot = 1
    
    -- Utility Functions
    local function RGBToColor3(rgb)
        return Color3.fromRGB(rgb[1], rgb[2], rgb[3])
    end
    
    local function Color3ToRGB(c)
        return {math.floor(c.R * 255), math.floor(c.G * 255), math.floor(c.B * 255)}
    end
    
    local function Lerp(a, b, t)
        return a + (b - a) * t
    end
    
    -- Create Main GUI
    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "LennyHub"
    ScreenGui.ResetOnSpawn = false
    ScreenGui.IgnoreGuiInset = true
    ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    if syn then ScreenGui.Parent = syn.protect_gui and syn.protect_gui(ScreenGui) or CoreGui else ScreenGui.Parent = CoreGui end
    
    -- MINIMIZE BUTTON (Floating)
    local MinimizeButton = Instance.new("TextButton")
    MinimizeButton.Name = "MinimizeButton"
    MinimizeButton.Parent = ScreenGui
    MinimizeButton.Size = UDim2.new(0, 55, 0, 55)
    MinimizeButton.Position = UDim2.new(0, 20, 0.5, -27)
    MinimizeButton.BackgroundColor3 = RGBToColor3(Config.ThemeColor)
    MinimizeButton.Text = "L"
    MinimizeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    MinimizeButton.Font = Enum.Font.GothamBlack
    MinimizeButton.TextSize = 28
    MinimizeButton.AutoButtonColor = false
    MinimizeButton.Visible = false
    MinimizeButton.ZIndex = 999
    
    local MinimizeButtonCorner = Instance.new("UICorner")
    MinimizeButtonCorner.CornerRadius = UDim.new(1, 0)
    MinimizeButtonCorner.Parent = MinimizeButton
    
    local MinimizeButtonStroke = Instance.new("UIStroke")
    MinimizeButtonStroke.Color = Color3.fromRGB(255, 255, 255)
    MinimizeButtonStroke.Thickness = 3
    MinimizeButtonStroke.Parent = MinimizeButton
    
    -- Draggable minimize button
    local minDragging = false
    local minDragStart = nil
    local minStartPos = nil
    
    MinimizeButton.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            minDragging = true
            minDragStart = input.Position
            minStartPos = MinimizeButton.Position
        end
    end)
    
    MinimizeButton.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            minDragging = false
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if minDragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            local delta = input.Position - minDragStart
            MinimizeButton.Position = UDim2.new(minStartPos.X.Scale, minStartPos.X.Offset + delta.X, minStartPos.Y.Scale, minStartPos.Y.Offset + delta.Y)
        end
    end)
    
    -- MAIN FRAME
    local MainFrame = Instance.new("Frame")
    MainFrame.Name = "MainFrame"
    MainFrame.Parent = ScreenGui
    MainFrame.Size = UDim2.new(0, 420, 0, 520)
    MainFrame.Position = UDim2.new(0.5, -210, 0.5, -260)
    MainFrame.BackgroundColor3 = Color3.fromRGB(18, 18, 24)
    MainFrame.BorderSizePixel = 0
    MainFrame.ClipsDescendants = true
    
    local MainFrameCorner = Instance.new("UICorner")
    MainFrameCorner.CornerRadius = UDim.new(0, 12)
    MainFrameCorner.Parent = MainFrame
    
    local MainFrameStroke = Instance.new("UIStroke")
    MainFrameStroke.Name = "MainStroke"
    MainFrameStroke.Color = RGBToColor3(Config.ThemeColor)
    MainFrameStroke.Thickness = 2
    MainFrameStroke.Parent = MainFrame
    
    -- Make main frame draggable
    local mainDragging = false
    local mainDragStart = nil
    local mainStartPos = nil
    
    MainFrame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            mainDragging = true
            mainDragStart = input.Position
            mainStartPos = MainFrame.Position
        end
    end)
    
    MainFrame.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            mainDragging = false
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if mainDragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            local delta = input.Position - mainDragStart
            MainFrame.Position = UDim2.new(mainStartPos.X.Scale, mainStartPos.X.Offset + delta.X, mainStartPos.Y.Scale, mainStartPos.Y.Offset + delta.Y)
        end
    end)
    
    -- TOP BAR
    local TopBar = Instance.new("Frame")
    TopBar.Name = "TopBar"
    TopBar.Parent = MainFrame
    TopBar.Size = UDim2.new(1, 0, 0, 50)
    TopBar.BackgroundColor3 = Color3.fromRGB(25, 25, 32)
    TopBar.BorderSizePixel = 0
    
    local TopBarCorner = Instance.new("UICorner")
    TopBarCorner.CornerRadius = UDim.new(0, 12)
    TopBarCorner.Parent = TopBar
    
    local TopBarCover = Instance.new("Frame")
    TopBarCover.Parent = TopBar
    TopBarCover.Size = UDim2.new(1, 0, 0, 15)
    TopBarCover.Position = UDim2.new(0, 0, 1, -15)
    TopBarCover.BackgroundColor3 = Color3.fromRGB(25, 25, 32)
    TopBarCover.BorderSizePixel = 0
    
    local TitleLabel = Instance.new("TextLabel")
    TitleLabel.Name = "Title"
    TitleLabel.Parent = TopBar
    TitleLabel.Size = UDim2.new(1, -130, 1, 0)
    TitleLabel.Position = UDim2.new(0, 15, 0, 0)
    TitleLabel.BackgroundTransparency = 1
    TitleLabel.Text = "LENNY HUB " .. CURRENT_VERSION
    TitleLabel.TextColor3 = RGBToColor3(Config.ThemeColor)
    TitleLabel.Font = Enum.Font.GothamBlack
    TitleLabel.TextSize = 18
    TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
    
    -- Minimize Button (Top Bar)
    local TopMinBtn = Instance.new("TextButton")
    TopMinBtn.Name = "MinBtn"
    TopMinBtn.Parent = TopBar
    TopMinBtn.Size = UDim2.new(0, 35, 0, 35)
    TopMinBtn.Position = UDim2.new(1, -85, 0.5, -17)
    TopMinBtn.BackgroundColor3 = Color3.fromRGB(59, 130, 246)
    TopMinBtn.Text = "‚Äî"
    TopMinBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    TopMinBtn.Font = Enum.Font.GothamBlack
    TopMinBtn.TextSize = 20
    TopMinBtn.AutoButtonColor = false
    
    local TopMinBtnCorner = Instance.new("UICorner")
    TopMinBtnCorner.CornerRadius = UDim.new(0, 8)
    TopMinBtnCorner.Parent = TopMinBtn
    
    -- Close Button
    local CloseBtn = Instance.new("TextButton")
    CloseBtn.Name = "CloseBtn"
    CloseBtn.Parent = TopBar
    CloseBtn.Size = UDim2.new(0, 35, 0, 35)
    CloseBtn.Position = UDim2.new(1, -45, 0.5, -17)
    CloseBtn.BackgroundColor3 = Color3.fromRGB(239, 68, 68)
    CloseBtn.Text = "√ó"
    CloseBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    CloseBtn.Font = Enum.Font.GothamBlack
    CloseBtn.TextSize = 24
    CloseBtn.AutoButtonColor = false
    
    local CloseBtnCorner = Instance.new("UICorner")
    CloseBtnCorner.CornerRadius = UDim.new(0, 8)
    CloseBtnCorner.Parent = CloseBtn
    
    -- TAB CONTAINER
    local TabContainer = Instance.new("Frame")
    TabContainer.Name = "TabContainer"
    TabContainer.Parent = MainFrame
    TabContainer.Size = UDim2.new(1, -20, 0, 40)
    TabContainer.Position = UDim2.new(0, 10, 0, 55)
    TabContainer.BackgroundTransparency = 1
    
    local TabLayout = Instance.new("UIListLayout")
    TabLayout.Parent = TabContainer
    TabLayout.FillDirection = Enum.FillDirection.Horizontal
    TabLayout.Padding = UDim.new(0, 8)
    TabLayout.SortOrder = Enum.SortOrder.LayoutOrder
    
    -- Tab Data
    local Tabs = {
        {Name = "Aim", Icon = "üéØ"},
        {Name = "ESP", Icon = "üëÅ"},
        {Name = "Visuals", Icon = "üé®"},
        {Name = "Settings", Icon = "‚öô"}
    }
    
    local TabButtons = {}
    local TabFrames = {}
    local CurrentTab = "Aim"
    
    for i, tabData in ipairs(Tabs) do
        local tabBtn = Instance.new("TextButton")
        tabBtn.Name = tabData.Name .. "Tab"
        tabBtn.Parent = TabContainer
        tabBtn.Size = UDim2.new(0, 95, 1, 0)
        tabBtn.BackgroundColor3 = i == 1 and RGBToColor3(Config.ThemeColor) or Color3.fromRGB(40, 40, 50)
        tabBtn.Text = tabData.Icon .. " " .. tabData.Name
        tabBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
        tabBtn.Font = Enum.Font.GothamBold
        tabBtn.TextSize = 13
        tabBtn.AutoButtonColor = false
        tabBtn.LayoutOrder = i
        
        local tabBtnCorner = Instance.new("UICorner")
        tabBtnCorner.CornerRadius = UDim.new(0, 8)
        tabBtnCorner.Parent = tabBtn
        
        TabButtons[tabData.Name] = tabBtn
    end
    
    -- CONTENT FRAME
    local ContentFrame = Instance.new("Frame")
    ContentFrame.Name = "ContentFrame"
    ContentFrame.Parent = MainFrame
    ContentFrame.Size = UDim2.new(1, -20, 1, -110)
    ContentFrame.Position = UDim2.new(0, 10, 0, 100)
    ContentFrame.BackgroundTransparency = 1
    ContentFrame.ClipsDescendants = true
    
    -- Create Tab Content Frames
    for _, tabData in ipairs(Tabs) do
        local tabFrame = Instance.new("ScrollingFrame")
        tabFrame.Name = tabData.Name .. "Content"
        tabFrame.Parent = ContentFrame
        tabFrame.Size = UDim2.new(1, 0, 1, 0)
        tabFrame.BackgroundTransparency = 1
        tabFrame.BorderSizePixel = 0
        tabFrame.ScrollBarThickness = 4
        tabFrame.ScrollBarImageColor3 = RGBToColor3(Config.ThemeColor)
        tabFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
        tabFrame.AutomaticCanvasSize = Enum.AutomaticSize.Y
        tabFrame.Visible = tabData.Name == "Aim"
        
        local tabLayout = Instance.new("UIListLayout")
        tabLayout.Parent = tabFrame
        tabLayout.Padding = UDim.new(0, 10)
        tabLayout.SortOrder = Enum.SortOrder.LayoutOrder
        
        local tabPadding = Instance.new("UIPadding")
        tabPadding.Parent = tabFrame
        tabPadding.PaddingRight = UDim.new(0, 8)
        tabPadding.PaddingBottom = UDim.new(0, 10)
        
        TabFrames[tabData.Name] = tabFrame
    end
    
    -- Tab Switching
    local function SwitchTab(tabName)
        CurrentTab = tabName
        for name, btn in pairs(TabButtons) do
            TweenService:Create(btn, TweenInfo.new(0.25), {
                BackgroundColor3 = name == tabName and RGBToColor3(Config.ThemeColor) or Color3.fromRGB(40, 40, 50)
            }):Play()
        end
        for name, frame in pairs(TabFrames) do
            frame.Visible = name == tabName
        end
    end
    
    for tabName, btn in pairs(TabButtons) do
        btn.MouseButton1Click:Connect(function()
            SwitchTab(tabName)
        end)
    end
    
    -- UI ELEMENT CREATORS
    local function CreateSection(parent, title)
        local section = Instance.new("Frame")
        section.Name = title .. "Section"
        section.Parent = parent
        section.Size = UDim2.new(1, 0, 0, 0)
        section.AutomaticSize = Enum.AutomaticSize.Y
        section.BackgroundColor3 = Color3.fromRGB(28, 28, 36)
        section.BorderSizePixel = 0
        section.LayoutOrder = #parent:GetChildren()
        
        local sectionCorner = Instance.new("UICorner")
        sectionCorner.CornerRadius = UDim.new(0, 10)
        sectionCorner.Parent = section
        
        local sectionPadding = Instance.new("UIPadding")
        sectionPadding.Parent = section
        sectionPadding.PaddingTop = UDim.new(0, 8)
        sectionPadding.PaddingBottom = UDim.new(0, 12)
        sectionPadding.PaddingLeft = UDim.new(0, 12)
        sectionPadding.PaddingRight = UDim.new(0, 12)
        
        local sectionLayout = Instance.new("UIListLayout")
        sectionLayout.Parent = section
        sectionLayout.Padding = UDim.new(0, 8)
        sectionLayout.SortOrder = Enum.SortOrder.LayoutOrder
        
        local sectionTitle = Instance.new("TextLabel")
        sectionTitle.Name = "Title"
        sectionTitle.Parent = section
        sectionTitle.Size = UDim2.new(1, 0, 0, 25)
        sectionTitle.BackgroundTransparency = 1
        sectionTitle.Text = title
        sectionTitle.TextColor3 = RGBToColor3(Config.ThemeColor)
        sectionTitle.Font = Enum.Font.GothamBold
        sectionTitle.TextSize = 14
        sectionTitle.TextXAlignment = Enum.TextXAlignment.Left
        sectionTitle.LayoutOrder = 0
        
        local divider = Instance.new("Frame")
        divider.Name = "Divider"
        divider.Parent = section
        divider.Size = UDim2.new(1, 0, 0, 1)
        divider.BackgroundColor3 = RGBToColor3(Config.ThemeColor)
        divider.BackgroundTransparency = 0.7
        divider.BorderSizePixel = 0
        divider.LayoutOrder = 1
        
        return section
    end
    
    local function CreateToggle(parent, text, configKey, callback)
        local toggleFrame = Instance.new("Frame")
        toggleFrame.Name = text .. "Toggle"
        toggleFrame.Parent = parent
        toggleFrame.Size = UDim2.new(1, 0, 0, 36)
        toggleFrame.BackgroundColor3 = Color3.fromRGB(38, 38, 48)
        toggleFrame.BorderSizePixel = 0
        toggleFrame.LayoutOrder = #parent:GetChildren()
        
        local toggleCorner = Instance.new("UICorner")
        toggleCorner.CornerRadius = UDim.new(0, 8)
        toggleCorner.Parent = toggleFrame
        
        local label = Instance.new("TextLabel")
        label.Parent = toggleFrame
        label.Size = UDim2.new(1, -65, 1, 0)
        label.Position = UDim2.new(0, 12, 0, 0)
        label.BackgroundTransparency = 1
        label.Text = text
        label.TextColor3 = Color3.fromRGB(255, 255, 255)
        label.Font = Enum.Font.Gotham
        label.TextSize = 13
        label.TextXAlignment = Enum.TextXAlignment.Left
        
        local switchBg = Instance.new("Frame")
        switchBg.Name = "SwitchBg"
        switchBg.Parent = toggleFrame
        switchBg.Size = UDim2.new(0, 48, 0, 24)
        switchBg.Position = UDim2.new(1, -56, 0.5, -12)
        switchBg.BackgroundColor3 = Config[configKey] and RGBToColor3(Config.ThemeColor) or Color3.fromRGB(60, 60, 70)
        switchBg.BorderSizePixel = 0
        
        local switchBgCorner = Instance.new("UICorner")
        switchBgCorner.CornerRadius = UDim.new(1, 0)
        switchBgCorner.Parent = switchBg
        
        local switchKnob = Instance.new("Frame")
        switchKnob.Name = "Knob"
        switchKnob.Parent = switchBg
        switchKnob.Size = UDim2.new(0, 18, 0, 18)
        switchKnob.Position = Config[configKey] and UDim2.new(1, -21, 0.5, -9) or UDim2.new(0, 3, 0.5, -9)
        switchKnob.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
        switchKnob.BorderSizePixel = 0
        
        local knobCorner = Instance.new("UICorner")
        knobCorner.CornerRadius = UDim.new(1, 0)
        knobCorner.Parent = switchKnob
        
        local button = Instance.new("TextButton")
        button.Parent = toggleFrame
        button.Size = UDim2.new(1, 0, 1, 0)
        button.BackgroundTransparency = 1
        button.Text = ""
        
        local function UpdateToggle()
            TweenService:Create(switchBg, TweenInfo.new(0.2), {
                BackgroundColor3 = Config[configKey] and RGBToColor3(Config.ThemeColor) or Color3.fromRGB(60, 60, 70)
            }):Play()
            TweenService:Create(switchKnob, TweenInfo.new(0.2), {
                Position = Config[configKey] and UDim2.new(1, -21, 0.5, -9) or UDim2.new(0, 3, 0.5, -9)
            }):Play()
        end
        
        button.MouseButton1Click:Connect(function()
            Config[configKey] = not Config[configKey]
            UpdateToggle()
            if callback then callback(Config[configKey]) end
        end)
        
        return toggleFrame, UpdateToggle
    end
    
    local function CreateSlider(parent, text, min, max, configKey, callback, formatFunc)
        local sliderFrame = Instance.new("Frame")
        sliderFrame.Name = text .. "Slider"
        sliderFrame.Parent = parent
        sliderFrame.Size = UDim2.new(1, 0, 0, 55)
        sliderFrame.BackgroundColor3 = Color3.fromRGB(38, 38, 48)
        sliderFrame.BorderSizePixel = 0
        sliderFrame.LayoutOrder = #parent:GetChildren()
        
        local sliderCorner = Instance.new("UICorner")
        sliderCorner.CornerRadius = UDim.new(0, 8)
        sliderCorner.Parent = sliderFrame
        
        local label = Instance.new("TextLabel")
        label.Parent = sliderFrame
        label.Size = UDim2.new(1, -70, 0, 22)
        label.Position = UDim2.new(0, 12, 0, 6)
        label.BackgroundTransparency = 1
        label.Text = text
        label.TextColor3 = Color3.fromRGB(255, 255, 255)
        label.Font = Enum.Font.Gotham
        label.TextSize = 13
        label.TextXAlignment = Enum.TextXAlignment.Left
        
        local valueLabel = Instance.new("TextLabel")
        valueLabel.Name = "Value"
        valueLabel.Parent = sliderFrame
        valueLabel.Size = UDim2.new(0, 55, 0, 22)
        valueLabel.Position = UDim2.new(1, -62, 0, 6)
        valueLabel.BackgroundTransparency = 1
        valueLabel.Text = formatFunc and formatFunc(Config[configKey]) or tostring(math.floor(Config[configKey]))
        valueLabel.TextColor3 = RGBToColor3(Config.ThemeColor)
        valueLabel.Font = Enum.Font.GothamBold
        valueLabel.TextSize = 13
        
        local track = Instance.new("Frame")
        track.Name = "Track"
        track.Parent = sliderFrame
        track.Size = UDim2.new(1, -24, 0, 8)
        track.Position = UDim2.new(0, 12, 0, 36)
        track.BackgroundColor3 = Color3.fromRGB(55, 55, 65)
        track.BorderSizePixel = 0
        
        local trackCorner = Instance.new("UICorner")
        trackCorner.CornerRadius = UDim.new(1, 0)
        trackCorner.Parent = track
        
        local fill = Instance.new("Frame")
        fill.Name = "Fill"
        fill.Parent = track
        fill.Size = UDim2.new((Config[configKey] - min) / (max - min), 0, 1, 0)
        fill.BackgroundColor3 = RGBToColor3(Config.ThemeColor)
        fill.BorderSizePixel = 0
        
        local fillCorner = Instance.new("UICorner")
        fillCorner.CornerRadius = UDim.new(1, 0)
        fillCorner.Parent = fill
        
        local knob = Instance.new("Frame")
        knob.Name = "Knob"
        knob.Parent = track
        knob.Size = UDim2.new(0, 16, 0, 16)
        knob.Position = UDim2.new((Config[configKey] - min) / (max - min), -8, 0.5, -8)
        knob.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
        knob.BorderSizePixel = 0
        knob.ZIndex = 5
        
        local knobCorner = Instance.new("UICorner")
        knobCorner.CornerRadius = UDim.new(1, 0)
        knobCorner.Parent = knob
        
        local knobStroke = Instance.new("UIStroke")
        knobStroke.Color = RGBToColor3(Config.ThemeColor)
        knobStroke.Thickness = 2
        knobStroke.Parent = knob
        
        local sliderDragging = false
        
        local function UpdateSlider(value)
            value = math.clamp(value, min, max)
            
            if configKey == "Smoothness" or configKey == "Prediction" or configKey == "UITransparency" then
                value = math.floor(value * 100) / 100
            else
                value = math.floor(value)
            end
            
            Config[configKey] = value
            
            local percent = (value - min) / (max - min)
            fill.Size = UDim2.new(percent, 0, 1, 0)
            knob.Position = UDim2.new(percent, -8, 0.5, -8)
            valueLabel.Text = formatFunc and formatFunc(value) or tostring(value)
            
            if callback then callback(value) end
        end
        
        knob.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                sliderDragging = true
            end
        end)
        
        track.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                sliderDragging = true
                local mousePos = UserInputService:GetMouseLocation().X
                local trackPos = track.AbsolutePosition.X
                local trackSize = track.AbsoluteSize.X
                local percent = math.clamp((mousePos - trackPos) / trackSize, 0, 1)
                UpdateSlider(min + (percent * (max - min)))
            end
        end)
        
        UserInputService.InputEnded:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                sliderDragging = false
            end
        end)
        
        UserInputService.InputChanged:Connect(function(input)
            if sliderDragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
                local mousePos = UserInputService:GetMouseLocation().X
                local trackPos = track.AbsolutePosition.X
                local trackSize = track.AbsoluteSize.X
                local percent = math.clamp((mousePos - trackPos) / trackSize, 0, 1)
                UpdateSlider(min + (percent * (max - min)))
            end
        end)
        
        return sliderFrame
    end
    
    local function CreateDropdown(parent, text, options, configKey, callback)
        local dropdownFrame = Instance.new("Frame")
        dropdownFrame.Name = text .. "Dropdown"
        dropdownFrame.Parent = parent
        dropdownFrame.Size = UDim2.new(1, 0, 0, 36)
        dropdownFrame.BackgroundColor3 = Color3.fromRGB(38, 38, 48)
        dropdownFrame.BorderSizePixel = 0
        dropdownFrame.LayoutOrder = #parent:GetChildren()
        dropdownFrame.ClipsDescendants = false
        dropdownFrame.ZIndex = 10
        
        local dropdownCorner = Instance.new("UICorner")
        dropdownCorner.CornerRadius = UDim.new(0, 8)
        dropdownCorner.Parent = dropdownFrame
        
        local label = Instance.new("TextLabel")
        label.Parent = dropdownFrame
        label.Size = UDim2.new(0.5, -10, 1, 0)
        label.Position = UDim2.new(0, 12, 0, 0)
        label.BackgroundTransparency = 1
        label.Text = text
        label.TextColor3 = Color3.fromRGB(255, 255, 255)
        label.Font = Enum.Font.Gotham
        label.TextSize = 13
        label.TextXAlignment = Enum.TextXAlignment.Left
        label.ZIndex = 10
        
        local selectedBtn = Instance.new("TextButton")
        selectedBtn.Name = "Selected"
        selectedBtn.Parent = dropdownFrame
        selectedBtn.Size = UDim2.new(0.45, 0, 0, 28)
        selectedBtn.Position = UDim2.new(0.52, 0, 0.5, -14)
        selectedBtn.BackgroundColor3 = Color3.fromRGB(55, 55, 65)
        selectedBtn.Text = Config[configKey] .. " ‚ñº"
        selectedBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
        selectedBtn.Font = Enum.Font.GothamBold
        selectedBtn.TextSize = 12
        selectedBtn.AutoButtonColor = false
        selectedBtn.ZIndex = 11
        
        local selectedCorner = Instance.new("UICorner")
        selectedCorner.CornerRadius = UDim.new(0, 6)
        selectedCorner.Parent = selectedBtn
        
        local optionsFrame = Instance.new("Frame")
        optionsFrame.Name = "Options"
        optionsFrame.Parent = dropdownFrame
        optionsFrame.Size = UDim2.new(0.45, 0, 0, #options * 30)
        optionsFrame.Position = UDim2.new(0.52, 0, 1, 5)
        optionsFrame.BackgroundColor3 = Color3.fromRGB(45, 45, 55)
        optionsFrame.BorderSizePixel = 0
        optionsFrame.Visible = false
        optionsFrame.ZIndex = 100
        optionsFrame.ClipsDescendants = true
        
        local optionsCorner = Instance.new("UICorner")
        optionsCorner.CornerRadius = UDim.new(0, 6)
        optionsCorner.Parent = optionsFrame
        
        local optionsLayout = Instance.new("UIListLayout")
        optionsLayout.Parent = optionsFrame
        optionsLayout.SortOrder = Enum.SortOrder.LayoutOrder
        
        for i, option in ipairs(options) do
            local optBtn = Instance.new("TextButton")
            optBtn.Name = option
            optBtn.Parent = optionsFrame
            optBtn.Size = UDim2.new(1, 0, 0, 30)
            optBtn.BackgroundColor3 = Config[configKey] == option and RGBToColor3(Config.ThemeColor) or Color3.fromRGB(45, 45, 55)
            optBtn.Text = option
            optBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
            optBtn.Font = Enum.Font.Gotham
            optBtn.TextSize = 12
            optBtn.AutoButtonColor = false
            optBtn.ZIndex = 101
            optBtn.LayoutOrder = i
            
            optBtn.MouseButton1Click:Connect(function()
                Config[configKey] = option
                selectedBtn.Text = option .. " ‚ñº"
                optionsFrame.Visible = false
                
                for _, child in pairs(optionsFrame:GetChildren()) do
                    if child:IsA("TextButton") then
                        child.BackgroundColor3 = child.Text == option and RGBToColor3(Config.ThemeColor) or Color3.fromRGB(45, 45, 55)
                    end
                end
                
                if callback then callback(option) end
            end)
            
            optBtn.MouseEnter:Connect(function()
                if Config[configKey] ~= option then
                    TweenService:Create(optBtn, TweenInfo.new(0.15), {BackgroundColor3 = Color3.fromRGB(60, 60, 70)}):Play()
                end
            end)
            
            optBtn.MouseLeave:Connect(function()
                if Config[configKey] ~= option then
                    TweenService:Create(optBtn, TweenInfo.new(0.15), {BackgroundColor3 = Color3.fromRGB(45, 45, 55)}):Play()
                end
            end)
        end
        
        selectedBtn.MouseButton1Click:Connect(function()
            optionsFrame.Visible = not optionsFrame.Visible
        end)
        
        return dropdownFrame
    end
    
    local function CreateColorPicker(parent, text, configKey, rainbowKey, callback)
        local colorFrame = Instance.new("Frame")
        colorFrame.Name = text .. "ColorPicker"
        colorFrame.Parent = parent
        colorFrame.Size = UDim2.new(1, 0, 0, 105)
        colorFrame.BackgroundColor3 = Color3.fromRGB(38, 38, 48)
        colorFrame.BorderSizePixel = 0
        colorFrame.LayoutOrder = #parent:GetChildren()
        
        local colorCorner = Instance.new("UICorner")
        colorCorner.CornerRadius = UDim.new(0, 8)
        colorCorner.Parent = colorFrame
        
        local label = Instance.new("TextLabel")
        label.Parent = colorFrame
        label.Size = UDim2.new(1, -90, 0, 24)
        label.Position = UDim2.new(0, 12, 0, 6)
        label.BackgroundTransparency = 1
        label.Text = text
        label.TextColor3 = Color3.fromRGB(255, 255, 255)
        label.Font = Enum.Font.Gotham
        label.TextSize = 13
        label.TextXAlignment = Enum.TextXAlignment.Left
        
        local preview = Instance.new("Frame")
        preview.Name = "Preview"
        preview.Parent = colorFrame
        preview.Size = UDim2.new(0, 40, 0, 24)
        preview.Position = UDim2.new(1, -85, 0, 6)
        preview.BackgroundColor3 = RGBToColor3(Config[configKey])
        preview.BorderSizePixel = 0
        
        local previewCorner = Instance.new("UICorner")
        previewCorner.CornerRadius = UDim.new(0, 6)
        previewCorner.Parent = preview
        
        if rainbowKey then
            local rainbowBtn = Instance.new("TextButton")
            rainbowBtn.Name = "Rainbow"
            rainbowBtn.Parent = colorFrame
            rainbowBtn.Size = UDim2.new(0, 32, 0, 24)
            rainbowBtn.Position = UDim2.new(1, -40, 0, 6)
            rainbowBtn.BackgroundColor3 = Config[rainbowKey] and RGBToColor3(Config.ThemeColor) or Color3.fromRGB(55, 55, 65)
            rainbowBtn.Text = "üåà"
            rainbowBtn.TextSize = 14
            rainbowBtn.AutoButtonColor = false
            
            local rainbowCorner = Instance.new("UICorner")
            rainbowCorner.CornerRadius = UDim.new(0, 6)
            rainbowCorner.Parent = rainbowBtn
            
            rainbowBtn.MouseButton1Click:Connect(function()
                Config[rainbowKey] = not Config[rainbowKey]
                rainbowBtn.BackgroundColor3 = Config[rainbowKey] and RGBToColor3(Config.ThemeColor) or Color3.fromRGB(55, 55, 65)
            end)
        end
        
        local colorNames = {"R", "G", "B"}
        local colorTints = {Color3.fromRGB(255, 100, 100), Color3.fromRGB(100, 255, 100), Color3.fromRGB(100, 150, 255)}
        
        for i = 1, 3 do
            local yPos = 35 + (i - 1) * 22
            
            local colorLabel = Instance.new("TextLabel")
            colorLabel.Parent = colorFrame
            colorLabel.Size = UDim2.new(0, 18, 0, 18)
            colorLabel.Position = UDim2.new(0, 12, 0, yPos)
            colorLabel.BackgroundTransparency = 1
            colorLabel.Text = colorNames[i]
            colorLabel.TextColor3 = colorTints[i]
            colorLabel.Font = Enum.Font.GothamBold
            colorLabel.TextSize = 12
            
            local track = Instance.new("Frame")
            track.Name = colorNames[i] .. "Track"
            track.Parent = colorFrame
            track.Size = UDim2.new(1, -85, 0, 6)
            track.Position = UDim2.new(0, 35, 0, yPos + 6)
            track.BackgroundColor3 = Color3.fromRGB(55, 55, 65)
            track.BorderSizePixel = 0
            
            local trackCorner = Instance.new("UICorner")
            trackCorner.CornerRadius = UDim.new(1, 0)
            trackCorner.Parent = track
            
            local fill = Instance.new("Frame")
            fill.Name = "Fill"
            fill.Parent = track
            fill.Size = UDim2.new(Config[configKey][i] / 255, 0, 1, 0)
            fill.BackgroundColor3 = colorTints[i]
            fill.BorderSizePixel = 0
            
            local fillCorner = Instance.new("UICorner")
            fillCorner.CornerRadius = UDim.new(1, 0)
            fillCorner.Parent = fill
            
            local knob = Instance.new("Frame")
            knob.Name = "Knob"
            knob.Parent = track
            knob.Size = UDim2.new(0, 12, 0, 12)
            knob.Position = UDim2.new(Config[configKey][i] / 255, -6, 0.5, -6)
            knob.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
            knob.BorderSizePixel = 0
            knob.ZIndex = 5
            
            local knobCorner = Instance.new("UICorner")
            knobCorner.CornerRadius = UDim.new(1, 0)
            knobCorner.Parent = knob
            
            local valueLabel = Instance.new("TextLabel")
            valueLabel.Parent = colorFrame
            valueLabel.Size = UDim2.new(0, 32, 0, 18)
            valueLabel.Position = UDim2.new(1, -42, 0, yPos)
            valueLabel.BackgroundTransparency = 1
            valueLabel.Text = tostring(Config[configKey][i])
            valueLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
            valueLabel.Font = Enum.Font.Gotham
            valueLabel.TextSize = 11
            
            local colorDragging = false
            local colorIndex = i
            
            local function UpdateColor(value)
                value = math.clamp(math.floor(value), 0, 255)
                Config[configKey][colorIndex] = value
                
                local percent = value / 255
                fill.Size = UDim2.new(percent, 0, 1, 0)
                knob.Position = UDim2.new(percent, -6, 0.5, -6)
                valueLabel.Text = tostring(value)
                
                preview.BackgroundColor3 = RGBToColor3(Config[configKey])
                
                if rainbowKey then
                    Config[rainbowKey] = false
                end
                
                if callback then callback(Config[configKey]) end
            end
            
            knob.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                    colorDragging = true
                end
            end)
            
            track.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                    colorDragging = true
                    local mousePos = UserInputService:GetMouseLocation().X
                    local trackPos = track.AbsolutePosition.X
                    local trackSize = track.AbsoluteSize.X
                    local percent = math.clamp((mousePos - trackPos) / trackSize, 0, 1)
                    UpdateColor(percent * 255)
                end
            end)
            
            UserInputService.InputEnded:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                    colorDragging = false
                end
            end)
            
            UserInputService.InputChanged:Connect(function(input)
                if colorDragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
                    local mousePos = UserInputService:GetMouseLocation().X
                    local trackPos = track.AbsolutePosition.X
                    local trackSize = track.AbsoluteSize.X
                    local percent = math.clamp((mousePos - trackPos) / trackSize, 0, 1)
                    UpdateColor(percent * 255)
                end
            end)
        end
        
        return colorFrame
    end
    
    -- FOV CIRCLE
    local FOVCircle = Instance.new("Frame")
    FOVCircle.Name = "FOVCircle"
    FOVCircle.Parent = ScreenGui
    FOVCircle.AnchorPoint = Vector2.new(0.5, 0.5)
    FOVCircle.Size = UDim2.new(0, Config.FOV * 2, 0, Config.FOV * 2)
    FOVCircle.BackgroundTransparency = 1
    FOVCircle.Visible = false
    FOVCircle.ZIndex = 1
    
    local FOVStroke = Instance.new("UIStroke")
    FOVStroke.Color = RGBToColor3(Config.FOVColor)
    FOVStroke.Thickness = 2
    FOVStroke.Transparency = 0.4
    FOVStroke.Parent = FOVCircle
    
    local FOVCorner = Instance.new("UICorner")
    FOVCorner.CornerRadius = UDim.new(1, 0)
    FOVCorner.Parent = FOVCircle
    
    -- CROSSHAIR
    local CrosshairFrame = Instance.new("Frame")
    CrosshairFrame.Name = "Crosshair"
    CrosshairFrame.Parent = ScreenGui
    CrosshairFrame.AnchorPoint = Vector2.new(0.5, 0.5)
    CrosshairFrame.Size = UDim2.new(0, 50, 0, 50)
    CrosshairFrame.BackgroundTransparency = 1
    CrosshairFrame.Visible = false
    CrosshairFrame.ZIndex = 2
    
    local CrosshairDot = Instance.new("Frame")
    CrosshairDot.Parent = CrosshairFrame
    CrosshairDot.AnchorPoint = Vector2.new(0.5, 0.5)
    CrosshairDot.Position = UDim2.new(0.5, 0, 0.5, 0)
    CrosshairDot.Size = UDim2.new(0, 4, 0, 4)
    CrosshairDot.BackgroundColor3 = RGBToColor3(Config.CrosshairColor)
    CrosshairDot.BorderSizePixel = 0
    
    local CrosshairDotCorner = Instance.new("UICorner")
    CrosshairDotCorner.CornerRadius = UDim.new(1, 0)
    CrosshairDotCorner.Parent = CrosshairDot
    
    local CrosshairH = Instance.new("Frame")
    CrosshairH.Parent = CrosshairFrame
    CrosshairH.AnchorPoint = Vector2.new(0.5, 0.5)
    CrosshairH.Position = UDim2.new(0.5, 0, 0.5, 0)
    CrosshairH.Size = UDim2.new(0, Config.CrosshairSize, 0, 2)
    CrosshairH.BackgroundColor3 = RGBToColor3(Config.CrosshairColor)
    CrosshairH.BorderSizePixel = 0
    CrosshairH.BackgroundTransparency = 0.2
    
    local CrosshairV = Instance.new("Frame")
    CrosshairV.Parent = CrosshairFrame
    CrosshairV.AnchorPoint = Vector2.new(0.5, 0.5)
    CrosshairV.Position = UDim2.new(0.5, 0, 0.5, 0)
    CrosshairV.Size = UDim2.new(0, 2, 0, Config.CrosshairSize)
    CrosshairV.BackgroundColor3 = RGBToColor3(Config.CrosshairColor)
    CrosshairV.BorderSizePixel = 0
    CrosshairV.BackgroundTransparency = 0.2
    
    -- TARGET HIGHLIGHT
    local TargetHighlight = Instance.new("Highlight")
    TargetHighlight.Name = "TargetHighlight"
    TargetHighlight.FillColor = RGBToColor3(Config.HighlightColor)
    TargetHighlight.OutlineColor = Color3.fromRGB(255, 255, 255)
    TargetHighlight.FillTransparency = 0.5
    TargetHighlight.OutlineTransparency = 0
    TargetHighlight.Enabled = false
    TargetHighlight.Parent = CoreGui
    
    -- Update screen center
    local function UpdateScreenCenter()
        local viewportSize = Camera.ViewportSize
        local centerX = viewportSize.X / 2
        local centerY = viewportSize.Y / 2
        
        FOVCircle.Position = UDim2.new(0, centerX, 0, centerY)
        FOVCircle.Size = UDim2.new(0, Config.FOV * 2, 0, Config.FOV * 2)
        
        CrosshairFrame.Position = UDim2.new(0, centerX, 0, centerY)
    end
    
    -- BUILD AIM TAB
    local aimSection = CreateSection(TabFrames.Aim, "üéØ Aimbot")
    CreateToggle(aimSection, "Enable Aimbot", "AimEnabled")
    CreateDropdown(aimSection, "Target Part", {"Head", "UpperTorso", "HumanoidRootPart", "LowerTorso", "Random"}, "AimPart")
    CreateToggle(aimSection, "Team Check", "TeamCheck")
    CreateToggle(aimSection, "Wall Check", "WallCheck")
    CreateSlider(aimSection, "FOV Size", 50, 500, "FOV", function(v)
        FOVCircle.Size = UDim2.new(0, v * 2, 0, v * 2)
    end)
    CreateSlider(aimSection, "Smoothness", 0.05, 1, "Smoothness", nil, function(v) return string.format("%.2f", v) end)
    CreateSlider(aimSection, "Max Distance", 100, 2000, "MaxDistance")
    CreateSlider(aimSection, "Prediction", 0, 0.5, "Prediction", nil, function(v) return string.format("%.2f", v) end)
    
    local highlightSection = CreateSection(TabFrames.Aim, "‚ú® Target Highlight")
    CreateToggle(highlightSection, "Enable Highlight", "HighlightEnabled")
    CreateColorPicker(highlightSection, "Highlight Color", "HighlightColor", "RainbowHighlight", function(color)
        TargetHighlight.FillColor = RGBToColor3(color)
    end)
    
    -- BUILD ESP TAB
    local espSection = CreateSection(TabFrames.ESP, "üëÅ ESP Settings")
    CreateToggle(espSection, "Enable ESP", "ESPEnabled")
    CreateToggle(espSection, "Show Names", "ESPNames")
    CreateToggle(espSection, "Show Health", "ESPHealth")
    CreateToggle(espSection, "Show Distance", "ESPDistance")
    CreateToggle(espSection, "3D Boxes", "ESPBoxes")
    CreateToggle(espSection, "Team Check", "TeamCheck")
    CreateSlider(espSection, "Text Size", 10, 22, "ESPTextSize")
    
    local espColorSection = CreateSection(TabFrames.ESP, "üé® ESP Colors")
    CreateColorPicker(espColorSection, "ESP Fill Color", "ESPColor", "RainbowESP")
    CreateColorPicker(espColorSection, "Box Color", "ESPBoxColor", nil)
    
    -- BUILD VISUALS TAB
    local fovSection = CreateSection(TabFrames.Visuals, "‚≠ï FOV Circle")
    CreateToggle(fovSection, "Show FOV Circle", "ShowFOV", function(enabled)
        FOVCircle.Visible = enabled
    end)
    CreateColorPicker(fovSection, "FOV Color", "FOVColor", "RainbowFOV", function(color)
        FOVStroke.Color = RGBToColor3(color)
    end)
    
    local crosshairSection = CreateSection(TabFrames.Visuals, "‚ûï Crosshair")
    CreateToggle(crosshairSection, "Show Crosshair", "ShowCrosshair", function(enabled)
        CrosshairFrame.Visible = enabled
    end)
    CreateSlider(crosshairSection, "Crosshair Size", 8, 50, "CrosshairSize", function(v)
        CrosshairH.Size = UDim2.new(0, v, 0, 2)
        CrosshairV.Size = UDim2.new(0, 2, 0, v)
    end)
    CreateColorPicker(crosshairSection, "Crosshair Color", "CrosshairColor", "RainbowCrosshair", function(color)
        CrosshairDot.BackgroundColor3 = RGBToColor3(color)
        CrosshairH.BackgroundColor3 = RGBToColor3(color)
        CrosshairV.BackgroundColor3 = RGBToColor3(color)
    end)
    
    -- BUILD SETTINGS TAB
    local themeSection = CreateSection(TabFrames.Settings, "üé® Theme")
    CreateToggle(themeSection, "Rainbow Theme", "RainbowTheme")
    CreateSlider(themeSection, "UI Transparency", 0, 0.8, "UITransparency", function(v)
        MainFrame.BackgroundTransparency = v
    end, function(v) return string.format("%.2f", v) end)
    CreateColorPicker(themeSection, "Theme Color", "ThemeColor", nil, function(color)
        MainFrameStroke.Color = RGBToColor3(color)
        TitleLabel.TextColor3 = RGBToColor3(color)
        MinimizeButton.BackgroundColor3 = RGBToColor3(color)
        for name, btn in pairs(TabButtons) do
            if name == CurrentTab then
                btn.BackgroundColor3 = RGBToColor3(color)
            end
        end
    end)
    
    local configSection = CreateSection(TabFrames.Settings, "üíæ Configuration")
    
    local slotFrame = Instance.new("Frame")
    slotFrame.Parent = configSection
    slotFrame.Size = UDim2.new(1, 0, 0, 40)
    slotFrame.BackgroundTransparency = 1
    slotFrame.LayoutOrder = #configSection:GetChildren()
    
    local slotLabel = Instance.new("TextLabel")
    slotLabel.Parent = slotFrame
    slotLabel.Size = UDim2.new(0, 80, 1, 0)
    slotLabel.BackgroundTransparency = 1
    slotLabel.Text = "Slot: " .. ConfigSlot
    slotLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    slotLabel.Font = Enum.Font.GothamBold
    slotLabel.TextSize = 13
    slotLabel.TextXAlignment = Enum.TextXAlignment.Left
    
    for i = 1, 5 do
        local slotBtn = Instance.new("TextButton")
        slotBtn.Parent = slotFrame
        slotBtn.Size = UDim2.new(0, 35, 0, 35)
        slotBtn.Position = UDim2.new(0, 80 + (i - 1) * 42, 0.5, -17)
        slotBtn.BackgroundColor3 = ConfigSlot == i and RGBToColor3(Config.ThemeColor) or Color3.fromRGB(55, 55, 65)
        slotBtn.Text = tostring(i)
        slotBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
        slotBtn.Font = Enum.Font.GothamBold
        slotBtn.TextSize = 14
        slotBtn.AutoButtonColor = false
        
        local slotBtnCorner = Instance.new("UICorner")
        slotBtnCorner.CornerRadius = UDim.new(0, 8)
        slotBtnCorner.Parent = slotBtn
        
        slotBtn.MouseButton1Click:Connect(function()
            ConfigSlot = i
            slotLabel.Text = "Slot: " .. i
            for _, child in pairs(slotFrame:GetChildren()) do
                if child:IsA("TextButton") then
                    child.BackgroundColor3 = tonumber(child.Text) == i and RGBToColor3(Config.ThemeColor) or Color3.fromRGB(55, 55, 65)
                end
            end
        end)
    end
    
    local buttonFrame = Instance.new("Frame")
    buttonFrame.Parent = configSection
    buttonFrame.Size = UDim2.new(1, 0, 0, 40)
    buttonFrame.BackgroundTransparency = 1
    buttonFrame.LayoutOrder = #configSection:GetChildren()
    
    local saveBtn = Instance.new("TextButton")
    saveBtn.Parent = buttonFrame
    saveBtn.Size = UDim2.new(0.32, 0, 0, 36)
    saveBtn.Position = UDim2.new(0, 0, 0.5, -18)
    saveBtn.BackgroundColor3 = Color3.fromRGB(34, 197, 94)
    saveBtn.Text = "SAVE"
    saveBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    saveBtn.Font = Enum.Font.GothamBold
    saveBtn.TextSize = 13
    saveBtn.AutoButtonColor = false
    
    local saveBtnCorner = Instance.new("UICorner")
    saveBtnCorner.CornerRadius = UDim.new(0, 8)
    saveBtnCorner.Parent = saveBtn
    
    local loadBtn = Instance.new("TextButton")
    loadBtn.Parent = buttonFrame
    loadBtn.Size = UDim2.new(0.32, 0, 0, 36)
    loadBtn.Position = UDim2.new(0.34, 0, 0.5, -18)
    loadBtn.BackgroundColor3 = Color3.fromRGB(59, 130, 246)
    loadBtn.Text = "LOAD"
    loadBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    loadBtn.Font = Enum.Font.GothamBold
    loadBtn.TextSize = 13
    loadBtn.AutoButtonColor = false
    
    local loadBtnCorner = Instance.new("UICorner")
    loadBtnCorner.CornerRadius = UDim.new(0, 8)
    loadBtnCorner.Parent = loadBtn
    
    local resetBtn = Instance.new("TextButton")
    resetBtn.Parent = buttonFrame
    resetBtn.Size = UDim2.new(0.32, 0, 0, 36)
    resetBtn.Position = UDim2.new(0.68, 0, 0.5, -18)
    resetBtn.BackgroundColor3 = Color3.fromRGB(239, 68, 68)
    resetBtn.Text = "RESET"
    resetBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    resetBtn.Font = Enum.Font.GothamBold
    resetBtn.TextSize = 13
    resetBtn.AutoButtonColor = false
    
    local resetBtnCorner = Instance.new("UICorner")
    resetBtnCorner.CornerRadius = UDim.new(0, 8)
    resetBtnCorner.Parent = resetBtn
    
    saveBtn.MouseButton1Click:Connect(function()
        pcall(function()
            if writefile then
                writefile("LennyHub_Slot_" .. ConfigSlot .. ".json", HttpService:JSONEncode(Config))
                game:GetService("StarterGui"):SetCore("SendNotification", {
                    Title = "LENNY HUB",
                    Text = "Config saved to Slot " .. ConfigSlot,
                    Duration = 3
                })
            end
        end)
    end)
    
    loadBtn.MouseButton1Click:Connect(function()
        pcall(function()
            if isfile and isfile("LennyHub_Slot_" .. ConfigSlot .. ".json") then
                local loaded = HttpService:JSONDecode(readfile("LennyHub_Slot_" .. ConfigSlot .. ".json"))
                for k, v in pairs(loaded) do
                    if Config[k] ~= nil then
                        Config[k] = v
                    end
                end
                FOVCircle.Visible = Config.ShowFOV
                CrosshairFrame.Visible = Config.ShowCrosshair
                UpdateScreenCenter()
                game:GetService("StarterGui"):SetCore("SendNotification", {
                    Title = "LENNY HUB",
                    Text = "Config loaded from Slot " .. ConfigSlot,
                    Duration = 3
                })
            end
        end)
    end)
    
    resetBtn.MouseButton1Click:Connect(function()
        game:GetService("StarterGui"):SetCore("SendNotification", {
            Title = "LENNY HUB",
            Text = "Config reset! Rejoin to apply.",
            Duration = 3
        })
    end)
    
    -- ESP SYSTEM
    local function CreateESP(player)
        if ESPObjects[player] then return end
        
        local espData = {
            Player = player,
            Highlight = nil,
            Billboard = nil,
            BoxLines = {}
        }
        
        local highlight = Instance.new("Highlight")
        highlight.Name = "ESP_" .. player.Name
        highlight.FillColor = RGBToColor3(Config.ESPColor)
        highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
        highlight.FillTransparency = 0.5
        highlight.OutlineTransparency = 0
        highlight.Enabled = false
        highlight.Parent = CoreGui
        espData.Highlight = highlight
        
        local billboard = Instance.new("BillboardGui")
        billboard.Name = "ESPText_" .. player.Name
        billboard.AlwaysOnTop = true
        billboard.Size = UDim2.new(0, 200, 0, 80)
        billboard.StudsOffset = Vector3.new(0, 3.5, 0)
        billboard.Enabled = false
        billboard.Parent = CoreGui
        
        local nameLabel = Instance.new("TextLabel")
        nameLabel.Name = "Name"
        nameLabel.Parent = billboard
        nameLabel.Size = UDim2.new(1, 0, 0, 18)
        nameLabel.Position = UDim2.new(0, 0, 0, 0)
        nameLabel.BackgroundTransparency = 1
        nameLabel.Text = player.Name
        nameLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
        nameLabel.Font = Enum.Font.GothamBold
        nameLabel.TextSize = Config.ESPTextSize
        nameLabel.TextStrokeTransparency = 0.5
        nameLabel.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
        
        local healthLabel = Instance.new("TextLabel")
        healthLabel.Name = "Health"
        healthLabel.Parent = billboard
        healthLabel.Size = UDim2.new(1, 0, 0, 18)
        healthLabel.Position = UDim2.new(0, 0, 0, 18)
        healthLabel.BackgroundTransparency = 1
        healthLabel.Text = "HP: 100"
        healthLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
        healthLabel.Font = Enum.Font.Gotham
        healthLabel.TextSize = Config.ESPTextSize
        healthLabel.TextStrokeTransparency = 0.5
        healthLabel.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
        
        local distLabel = Instance.new("TextLabel")
        distLabel.Name = "Distance"
        distLabel.Parent = billboard
        distLabel.Size = UDim2.new(1, 0, 0, 18)
        distLabel.Position = UDim2.new(0, 0, 0, 36)
        distLabel.BackgroundTransparency = 1
        distLabel.Text = "0m"
        distLabel.TextColor3 = Color3.fromRGB(255, 255, 0)
        distLabel.Font = Enum.Font.Gotham
        distLabel.TextSize = Config.ESPTextSize
        distLabel.TextStrokeTransparency = 0.5
        distLabel.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
        
        espData.Billboard = billboard
        
        if Drawing then
            for i = 1, 12 do
                local line = Drawing.new("Line")
                line.Thickness = 1.5
                line.Color = RGBToColor3(Config.ESPBoxColor)
                line.Transparency = 1
                line.Visible = false
                espData.BoxLines[i] = line
            end
        end
        
        ESPObjects[player] = espData
    end
    
    local function RemoveESP(player)
        if ESPObjects[player] then
            local esp = ESPObjects[player]
            if esp.Highlight then esp.Highlight:Destroy() end
            if esp.Billboard then esp.Billboard:Destroy() end
            if esp.BoxLines then
                for _, line in pairs(esp.BoxLines) do
                    if line then line:Remove() end
                end
            end
            ESPObjects[player] = nil
        end
    end
    
    local function GetBoxCorners(character)
        local rootPart = character:FindFirstChild("HumanoidRootPart")
        if not rootPart then return nil end
        
        local cf = rootPart.CFrame
        local size = Vector3.new(4, 5.5, 2.5)
        
        local corners = {}
        for x = -1, 1, 2 do
            for y = -1, 1, 2 do
                for z = -1, 1, 2 do
                    table.insert(corners, (cf * CFrame.new(size.X/2 * x, size.Y/2 * y, size.Z/2 * z)).Position)
                end
            end
        end
        
        return corners
    end
    
    local function WorldToScreen(pos)
        local screenPos, onScreen = Camera:WorldToViewportPoint(pos)
        return Vector2.new(screenPos.X, screenPos.Y), onScreen, screenPos.Z
    end
    
    local function UpdateESPBoxes(espData, character)
        if not Drawing or not Config.ESPBoxes then
            for _, line in pairs(espData.BoxLines) do
                if line then line.Visible = false end
            end
            return
        end
        
        local corners = GetBoxCorners(character)
        if not corners then
            for _, line in pairs(espData.BoxLines) do
                if line then line.Visible = false end
            end
            return
        end
        
        local screenCorners = {}
        local allValid = true
        
        for i, corner in ipairs(corners) do
            local screenPos, onScreen, depth = WorldToScreen(corner)
            if depth < 0 then
                allValid = false
                break
            end
            screenCorners[i] = screenPos
        end
        
        if not allValid or #screenCorners < 8 then
            for _, line in pairs(espData.BoxLines) do
                if line then line.Visible = false end
            end
            return
        end
        
        local edges = {
            {1, 2}, {3, 4}, {5, 6}, {7, 8},
            {1, 3}, {2, 4}, {5, 7}, {6, 8},
            {1, 5}, {2, 6}, {3, 7}, {4, 8}
        }
        
        for i, edge in ipairs(edges) do
            local line = espData.BoxLines[i]
            if line and screenCorners[edge[1]] and screenCorners[edge[2]] then
                line.From = screenCorners[edge[1]]
                line.To = screenCorners[edge[2]]
                line.Color = RGBToColor3(Config.ESPBoxColor)
                line.Visible = true
            elseif line then
                line.Visible = false
            end
        end
    end
    
    local function UpdateESP()
        for player, espData in pairs(ESPObjects) do
            if not player or not player.Parent then
                RemoveESP(player)
                continue
            end
            
            local character = player.Character
            if not character then
                if espData.Highlight then espData.Highlight.Enabled = false end
                if espData.Billboard then espData.Billboard.Enabled = false end
                for _, line in pairs(espData.BoxLines) do
                    if line then line.Visible = false end
                end
                continue
            end
            
            local humanoid = character:FindFirstChild("Humanoid")
            local rootPart = character:FindFirstChild("HumanoidRootPart")
            
            if not humanoid or humanoid.Health <= 0 or not rootPart then
                if espData.Highlight then espData.Highlight.Enabled = false end
                if espData.Billboard then espData.Billboard.Enabled = false end
                for _, line in pairs(espData.BoxLines) do
                    if line then line.Visible = false end
                end
                continue
            end
            
            if Config.TeamCheck and player.Team == LocalPlayer.Team then
                if espData.Highlight then espData.Highlight.Enabled = false end
                if espData.Billboard then espData.Billboard.Enabled = false end
                for _, line in pairs(espData.BoxLines) do
                    if line then line.Visible = false end
                end
                continue
            end
            
            if Config.ESPEnabled then
                espData.Highlight.Adornee = character
                espData.Highlight.FillColor = RGBToColor3(Config.ESPColor)
                espData.Highlight.Enabled = true
                
                espData.Billboard.Adornee = rootPart
                espData.Billboard.Enabled = Config.ESPNames or Config.ESPHealth or Config.ESPDistance
                
                local nameLabel = espData.Billboard:FindFirstChild("Name")
                local healthLabel = espData.Billboard:FindFirstChild("Health")
                local distLabel = espData.Billboard:FindFirstChild("Distance")
                
                if nameLabel then
                    nameLabel.Visible = Config.ESPNames
                    nameLabel.TextSize = Config.ESPTextSize
                end
                
                if healthLabel then
                    healthLabel.Visible = Config.ESPHealth
                    healthLabel.TextSize = Config.ESPTextSize
                    local hp = math.floor((humanoid.Health / humanoid.MaxHealth) * 100)
                    healthLabel.Text = "HP: " .. hp .. "%"
                    if hp > 70 then
                        healthLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
                    elseif hp > 40 then
                        healthLabel.TextColor3 = Color3.fromRGB(255, 255, 0)
                    else
                        healthLabel.TextColor3 = Color3.fromRGB(255, 0, 0)
                    end
                end
                
                if distLabel and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
                    distLabel.Visible = Config.ESPDistance
                    distLabel.TextSize = Config.ESPTextSize
                    local dist = math.floor((rootPart.Position - LocalPlayer.Character.HumanoidRootPart.Position).Magnitude)
                    distLabel.Text = dist .. "m"
                end
                
                UpdateESPBoxes(espData, character)
            else
                espData.Highlight.Enabled = false
                espData.Billboard.Enabled = false
                for _, line in pairs(espData.BoxLines) do
                    if line then line.Visible = false end
                end
            end
        end
    end
    
    -- Initialize ESP for existing players
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer then
            CreateESP(player)
        end
    end
    
    Players.PlayerAdded:Connect(CreateESP)
    Players.PlayerRemoving:Connect(RemoveESP)
    
    -- AIMBOT SYSTEM
    local function IsVisible(part)
        if not Config.WallCheck then return true end
        
        local origin = Camera.CFrame.Position
        local direction = (part.Position - origin).Unit * (part.Position - origin).Magnitude
        
        local params = RaycastParams.new()
        params.FilterDescendantsInstances = {LocalPlayer.Character, Camera}
        params.FilterType = Enum.RaycastFilterType.Exclude
        
        local result = Workspace:Raycast(origin, direction, params)
        
        if result then
            return result.Instance:IsDescendantOf(part.Parent)
        end
        
        return true
    end
    
    local function GetTargetPart(character)
        local partName = Config.AimPart
        
        if partName == "Random" then
            local parts = {"Head", "UpperTorso", "LowerTorso", "HumanoidRootPart"}
            partName = parts[math.random(1, #parts)]
        end
        
        return character:FindFirstChild(partName) or character:FindFirstChild("Head") or character:FindFirstChild("HumanoidRootPart")
    end
    
    local function GetClosestTarget()
        local viewportSize = Camera.ViewportSize
        local center = Vector2.new(viewportSize.X / 2, viewportSize.Y / 2)
        local closest = nil
        local closestDist = Config.FOV
        
        for _, player in pairs(Players:GetPlayers()) do
            if player == LocalPlayer then continue end
            if Config.TeamCheck and player.Team == LocalPlayer.Team then continue end
            
            local character = player.Character
            if not character then continue end
            
            local humanoid = character:FindFirstChild("Humanoid")
            if not humanoid or humanoid.Health <= 0 then continue end
            
            local targetPart = GetTargetPart(character)
            if not targetPart then continue end
            
            local worldDist = (targetPart.Position - Camera.CFrame.Position).Magnitude
            if worldDist > Config.MaxDistance then continue end
            
            if not IsVisible(targetPart) then continue end
            
            local screenPos, onScreen = Camera:WorldToViewportPoint(targetPart.Position)
            if not onScreen then continue end
            
            local screenDist = (Vector2.new(screenPos.X, screenPos.Y) - center).Magnitude
            
            if screenDist < closestDist then
                closestDist = screenDist
                closest = character
            end
        end
        
        return closest
    end
    
    -- MINIMIZE / MAXIMIZE
    local function MinimizeUI()
        IsMinimized = true
        TweenService:Create(MainFrame, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.In), {
            Size = UDim2.new(0, 0, 0, 0),
            Position = UDim2.new(0.5, 0, 0.5, 0)
        }):Play()
        task.wait(0.3)
        MainFrame.Visible = false
        MinimizeButton.Visible = true
    end
    
    local function MaximizeUI()
        IsMinimized = false
        MainFrame.Visible = true
        MainFrame.Size = UDim2.new(0, 0, 0, 0)
        MainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
        TweenService:Create(MainFrame, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
            Size = UDim2.new(0, 420, 0, 520),
            Position = UDim2.new(0.5, -210, 0.5, -260)
        }):Play()
        MinimizeButton.Visible = false
    end
    
    TopMinBtn.MouseButton1Click:Connect(MinimizeUI)
    MinimizeButton.MouseButton1Click:Connect(MaximizeUI)
    
    -- CLOSE BUTTON
    CloseBtn.MouseButton1Click:Connect(function()
        Config.AimEnabled = false
        Config.ESPEnabled = false
        Config.HighlightEnabled = false
        TargetHighlight.Enabled = false
        
        for _, esp in pairs(ESPObjects) do
            if esp.Highlight then esp.Highlight:Destroy() end
            if esp.Billboard then esp.Billboard:Destroy() end
            if esp.BoxLines then
                for _, line in pairs(esp.BoxLines) do
                    if line then line:Remove() end
                end
            end
        end
        
        ScreenGui:Destroy()
    end)
    
    -- Button hover effects
    TopMinBtn.MouseEnter:Connect(function()
        TweenService:Create(TopMinBtn, TweenInfo.new(0.15), {BackgroundColor3 = Color3.fromRGB(79, 150, 255)}):Play()
    end)
    TopMinBtn.MouseLeave:Connect(function()
        TweenService:Create(TopMinBtn, TweenInfo.new(0.15), {BackgroundColor3 = Color3.fromRGB(59, 130, 246)}):Play()
    end)
    
    CloseBtn.MouseEnter:Connect(function()
        TweenService:Create(CloseBtn, TweenInfo.new(0.15), {BackgroundColor3 = Color3.fromRGB(255, 88, 88)}):Play()
    end)
    CloseBtn.MouseLeave:Connect(function()
        TweenService:Create(CloseBtn, TweenInfo.new(0.15), {BackgroundColor3 = Color3.fromRGB(239, 68, 68)}):Play()
    end)
    
    MinimizeButton.MouseEnter:Connect(function()
        TweenService:Create(MinimizeButton, TweenInfo.new(0.15), {Size = UDim2.new(0, 60, 0, 60)}):Play()
    end)
    MinimizeButton.MouseLeave:Connect(function()
        TweenService:Create(MinimizeButton, TweenInfo.new(0.15), {Size = UDim2.new(0, 55, 0, 55)}):Play()
    end)
    
    -- MAIN LOOP
    RunService.Heartbeat:Connect(function()
        -- Rainbow effects
        RainbowHue = (RainbowHue + 0.5) % 360
        local rainbowColor = Color3.fromHSV(RainbowHue / 360, 1, 1)
        local rainbowRGB = Color3ToRGB(rainbowColor)
        
        if Config.RainbowTheme then
            Config.ThemeColor = rainbowRGB
            MainFrameStroke.Color = rainbowColor
            TitleLabel.TextColor3 = rainbowColor
            MinimizeButton.BackgroundColor3 = rainbowColor
            for name, btn in pairs(TabButtons) do
                if name == CurrentTab then
                    btn.BackgroundColor3 = rainbowColor
                end
            end
        end
        
        if Config.RainbowFOV then
            Config.FOVColor = rainbowRGB
            FOVStroke.Color = rainbowColor
        end
        
        if Config.RainbowCrosshair then
            Config.CrosshairColor = rainbowRGB
            CrosshairDot.BackgroundColor3 = rainbowColor
            CrosshairH.BackgroundColor3 = rainbowColor
            CrosshairV.BackgroundColor3 = rainbowColor
        end
        
        if Config.RainbowHighlight then
            Config.HighlightColor = rainbowRGB
            TargetHighlight.FillColor = rainbowColor
        end
        
        if Config.RainbowESP then
            Config.ESPColor = rainbowRGB
            for _, esp in pairs(ESPObjects) do
                if esp.Highlight then
                    esp.Highlight.FillColor = rainbowColor
                end
            end
        end
        
        -- Update screen center
        UpdateScreenCenter()
        
        -- Update ESP
        UpdateESP()
        
        -- Aimbot
        if Config.AimEnabled then
            local target = GetClosestTarget()
            CurrentTarget = target
            
            if target then
                if Config.HighlightEnabled then
                    TargetHighlight.Adornee = target
                    TargetHighlight.FillColor = RGBToColor3(Config.HighlightColor)
                    TargetHighlight.Enabled = true
                else
                    TargetHighlight.Enabled = false
                end
                
                local targetPart = GetTargetPart(target)
                if targetPart then
                    local targetPos = targetPart.Position
                    
                    if Config.Prediction > 0 then
                        local velocity = targetPart.Velocity
                        targetPos = targetPos + (velocity * Config.Prediction)
                    end
                    
                    local goalCF = CFrame.new(Camera.CFrame.Position, targetPos)
                    Camera.CFrame = Camera.CFrame:Lerp(goalCF, Config.Smoothness)
                end
            else
                TargetHighlight.Enabled = false
            end
        else
            CurrentTarget = nil
            TargetHighlight.Enabled = false
        end
    end)
    
    -- Notification
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = "LENNY HUB " .. CURRENT_VERSION,
        Text = "Successfully loaded! " .. (IsMobile and "üì±" or "üíª"),
        Duration = 5
    })
end
